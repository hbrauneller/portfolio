/**
 * @license almond 0.3.3 Copyright jQuery Foundation and other contributors.
 * Released under MIT license, http://github.com/requirejs/almond/LICENSE
 */

//     Underscore.js 1.8.3
//     http://underscorejs.org
//     (c) 2009-2015 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Underscore may be freely distributed under the MIT license.

/*!
 * JavaScript Cookie v2.1.4
 * https://github.com/js-cookie/js-cookie
 *
 * Copyright 2006, 2015 Klaus Hartl & Fagner Brack
 * Released under the MIT license
 */

/*!
 * Bowser - a browser detector
 * https://github.com/ded/bowser
 * MIT License | (c) Dustin Diaz 2015
 */

var requirejs,require,define;!function(e){function t(e,t){return y.call(e,t)}function n(e,t){var n,r,o,i,a,s,u,c,l,f,d,p,h=t&&t.split("/"),m=v.map,_=m&&m["*"]||{};if(e){for(e=e.split("/"),a=e.length-1,v.nodeIdCompat&&b.test(e[a])&&(e[a]=e[a].replace(b,"")),"."===e[0].charAt(0)&&h&&(p=h.slice(0,h.length-1),e=p.concat(e)),l=0;l<e.length;l++)if(d=e[l],"."===d)e.splice(l,1),l-=1;else if(".."===d){if(0===l||1===l&&".."===e[2]||".."===e[l-1])continue;l>0&&(e.splice(l-1,2),l-=2)}e=e.join("/")}if((h||_)&&m){for(n=e.split("/"),l=n.length;l>0;l-=1){if(r=n.slice(0,l).join("/"),h)for(f=h.length;f>0;f-=1)if(o=m[h.slice(0,f).join("/")],o&&(o=o[r])){i=o,s=l;break}if(i)break;!u&&_&&_[r]&&(u=_[r],c=l)}!i&&u&&(i=u,s=c),i&&(n.splice(0,s,i),e=n.join("/"))}return e}function r(t,n){return function(){var r=g.call(arguments,0);return"string"!=typeof r[0]&&1===r.length&&r.push(null),f.apply(e,r.concat([t,n]))}}function o(e){return function(t){return n(t,e)}}function i(e){return function(t){h[e]=t}}function a(n){if(t(m,n)){var r=m[n];delete m[n],_[n]=!0,l.apply(e,r)}if(!t(h,n)&&!t(_,n))throw new Error("No "+n);return h[n]}function s(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function u(e){return e?s(e):[]}function c(e){return function(){return v&&v.config&&v.config[e]||{}}}var l,f,d,p,h={},m={},v={},_={},y=Object.prototype.hasOwnProperty,g=[].slice,b=/\.js$/;d=function(e,t){var r,i=s(e),u=i[0],c=t[1];return e=i[1],u&&(u=n(u,c),r=a(u)),u?e=r&&r.normalize?r.normalize(e,o(c)):n(e,c):(e=n(e,c),i=s(e),u=i[0],e=i[1],u&&(r=a(u))),{f:u?u+"!"+e:e,n:e,pr:u,p:r}},p={require:function(e){return r(e)},exports:function(e){var t=h[e];return"undefined"!=typeof t?t:h[e]={}},module:function(e){return{id:e,uri:"",exports:h[e],config:c(e)}}},l=function(n,o,s,c){var l,f,v,y,g,b,w,T=[],k=typeof s;if(c=c||n,b=u(c),"undefined"===k||"function"===k){for(o=!o.length&&s.length?["require","exports","module"]:o,g=0;g<o.length;g+=1)if(y=d(o[g],b),f=y.f,"require"===f)T[g]=p.require(n);else if("exports"===f)T[g]=p.exports(n),w=!0;else if("module"===f)l=T[g]=p.module(n);else if(t(h,f)||t(m,f)||t(_,f))T[g]=a(f);else{if(!y.p)throw new Error(n+" missing "+f);y.p.load(y.n,r(c,!0),i(f),{}),T[g]=h[f]}v=s?s.apply(h[n],T):void 0,n&&(l&&l.exports!==e&&l.exports!==h[n]?h[n]=l.exports:v===e&&w||(h[n]=v))}else n&&(h[n]=s)},requirejs=require=f=function(t,n,r,o,i){if("string"==typeof t)return p[t]?p[t](n):a(d(t,u(n)).f);if(!t.splice){if(v=t,v.deps&&f(v.deps,v.callback),!n)return;n.splice?(t=n,n=r,r=null):t=e}return n=n||function(){},"function"==typeof r&&(r=o,o=i),o?l(e,t,n,r):setTimeout(function(){l(e,t,n,r)},4),f},f.config=function(e){return f(e)},requirejs._defined=h,define=function(e,n,r){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");n.splice||(r=n,n=[]),t(h,e)||t(m,e)||(m[e]=[e,n,r])},define.amd={jQuery:!0}}(),define("../bower_components/almond/almond",function(){}),function(){function e(e,t,n,r){this.name=e,this.entryType=t,this.startTime=n,this.duration=r}function t(e){for(var t,n={},r=[],o=0,i=s.length;o<i;o++)t=s[o],t.entryType!==e&&(n[t.name]=t,r.push(t));a=n,s=r}function n(e,t){window.performance[e]||("getEntries"===e&&(o=function(){return s}),window.performance[e]=t)}function r(e,n){if(void 0===n)t(e);else{for(var r,o=[],i=0;i<s.length;i++)r=s[i],r.name===n&&r.entryType===e||o.push(r);s=o,r=a[n],r&&r.entryType===e&&(a[n]=void 0)}}window.performance||(window.performance={});var o,i=(new Date).getTime(),a={},s=[],u={navigationStart:!0,unloadEventStart:!0,unloadEventEnd:!0,redirectStart:!0,redirectEnd:!0,fetchStart:!0,domainLookupStart:!0,domainLookupEnd:!0,connectStart:!0,connectEnd:!0,secureConnectionStart:!0,requestStart:!0,responseStart:!0,responseEnd:!0,domLoading:!0,domInteractive:!0,domContentLoadedEventStart:!0,domContentLoadedEventEnd:!0,domComplete:!0,loadEventStart:!0,loadEventEnd:!0};n("now",function(){return(new Date).getTime()-i}),n("mark",function(t){if(u[t])throw Error("'"+t+"' is part of the PerformanceTiming interface, and cannot be used as a mark name.");var n=new e(t,"mark",window.performance.now(),0);s.push(n),a[t]=n}),n("clearMarks",function(e){r("mark",e)}),n("measure",function(t,n,r){var o=void 0===n,i=void 0===r,u=window.performance.now(),c=0,l=0;if(o)c=0;else{if(!a[n])throw Error("The mark '"+n+"' does not exist.");c=a[n].startTime}if(i)l=u;else{if(!a[r])throw Error("The mark '"+r+"' does not exist.");l=a[r].startTime}var f=new e(t,"measure",u,l-c);s.push(f),a[t]=f}),n("clearMeasures",function(e){r("measure",e)}),n("getEntries",function(e){var t=o();if(void 0===e)return t;var n;return e.entryType?n=e.name?function(t){return t.entryType===e.entryType&&t.name===e.name}:function(t){return t.entryType===e.entryType}:e.name&&(n=function(t){return t.name===e.name}),t.filter(n)}),n("getEntriesByName",function(e,t){var n={name:e};return t&&(n.entryType=t),this.getEntries(n)}),n("getEntriesByType",function(e){return this.getEntries({entryType:e})})}(),define("polyfills/performance",function(){}),define("common/moment_loader/hex/moment_hex",[],function(){function e(t){"undefined"==typeof t&&(t=e.DEFAULT_OPTIONS),this.options=t,this.options.upload&&(this.DATA_MAP.uploadDate={beg:this.MOMENT_LENGTH,end:this.MOMENT_LENGTH+8},this.MOMENT_LENGTH+=8),this.options.story&&(this.DATA_MAP.uploadDate={beg:this.MOMENT_LENGTH,end:this.MOMENT_LENGTH+8},this.MOMENT_LENGTH+=8,this.DATA_MAP.personUid={beg:this.MOMENT_LENGTH,end:this.MOMENT_LENGTH+12},this.MOMENT_LENGTH+=12,this.DATA_MAP.createdDate={beg:this.MOMENT_LENGTH,end:this.MOMENT_LENGTH+8},this.MOMENT_LENGTH+=8),(this.options.signature||this.options.story)&&(this.DATA_MAP.signature={beg:this.MOMENT_LENGTH,end:this.MOMENT_LENGTH+16},this.MOMENT_LENGTH+=16),t.covers&&(this.DATA_MAP.covers={beg:this.MOMENT_LENGTH,end:this.MOMENT_LENGTH+1},this.MOMENT_LENGTH++)}return e.DEFAULT_OPTIONS={upload:!0,covers:!1,signature:!1},e.prototype.MOMENT_LENGTH=43,e.prototype.UID_LENGTH=16,e.prototype.DATA_MAP={dateNeg:{beg:0,end:1},date:{beg:1,end:9},uid:{beg:9,end:25},modified:{beg:25,end:33},height:{beg:33,end:37},width:{beg:37,end:41},flags:{beg:41,end:42},momentType:{beg:42,end:43}},e.prototype.pad=function(e,t){var n;for("undefined"==typeof t&&(t=4),n=""+e;t>n.length;)n="0"+n;return n},e.prototype.momentCount=function(e){return"undefined"!=typeof e?e.length/this.MOMENT_LENGTH:0},e}),define("server/worker_factory",["common/moment_loader/hex/moment_hex"],function(e){var t={allMomentsWorker:null,momentsSinceWorker:null,storyWorker:null,captionsWorker:null,momentsSinceScript:"/worker/moments_since_worker.js",allMomentsScript:"/worker/all_moments_worker.js",storyScript:"/worker/story_worker.js",createAllMomentsWorker:function(n,r,o,i,a,s){var u,c;u=e.DEFAULT_OPTIONS,c='["'+o+'", "'+i+'", null, '+u.upload+", "+u.signature+", "+u.covers+"]",t.allMomentsWorker?(t.allMomentsWorker.onerror=s,t._addMomentWorkerHandlers(t.allMomentsWorker,a,s),t.allMomentsWorker.postMessage([n,r,c])):(t.allMomentsWorker=new Worker(t.allMomentsScript),t.allMomentsWorker.onmessage=function(e){switch(e.data){case"loaded":t._addMomentWorkerHandlers(t.allMomentsWorker,a,s),t.allMomentsWorker.onerror=s,t.allMomentsWorker.postMessage([n,r,c])}})},createMomentsSinceWorker:function(n,r,o,i,a,s,u){var c,l;c=e.DEFAULT_OPTIONS,l='["'+i+'", "'+a+'", "'+r+'", true, '+c.upload+", "+c.signature+", "+c.covers+"]",t.momentsSinceWorker?(t._addMomentWorkerHandlers(t.momentsSinceWorker,s,u),t.momentsSinceWorker.postMessage([o,l,n])):(t.momentsSinceWorker=new Worker(t.momentsSinceScript),t.momentsSinceWorker.onmessage=function(e){switch(e.data){case"loaded":t._addMomentWorkerHandlers(t.momentsSinceWorker,s,u),t.momentsSinceWorker.postMessage([o,l,n])}})},createStoryWorker:function(e,n,r){var o=function(e){var t,n,o;return o=e.data,o.length&&(t=function(){var e,t,r;for(r=[],n=e=0,t=o.length-1;0<=t?e<=t:e>=t;n=0<=t?++e:--e)r.push(JSON.parse(o[n]));return r}()),r(t)};t.storyWorker?(t.storyWorker.onmessage=o,t.storyWorker.postMessage({momentsHex:e,filenames:n})):(t.storyWorker=new Worker(t.storyScript),t.storyWorker.onmessage=function(r){switch(r.data){case"loaded":t.storyWorker.onmessage=o,t.storyWorker.postMessage({momentsHex:e,filenames:n})}})},_addMomentWorkerHandlers:function(e,t,n){var r;return r=null,e.onerror=n,e.onmessage=function(e){var o,i,a,s,u,c;if(a=e.data[0],"hex"===a)return r=e.data[1],r.moments=[],r.moments;if("moments"===a){for(r||(r={},r.moments=[]),u=e.data[1],c=[],o=0,i=u.length;o<i;o++)s=u[o],c.push(r.moments.push(JSON.parse(s)));return c}return"done"===a?t(r):n(e)},e.onmessage}};return t}),function(){function e(e){function t(t,n,r,o,i,a){for(;i>=0&&i<a;i+=e){var s=o?o[i]:i;r=n(r,t[s],s,t)}return r}return function(n,r,o,i){r=g(r,i,4);var a=!M(n)&&y.keys(n),s=(a||n).length,u=e>0?0:s-1;return arguments.length<3&&(o=n[a?a[u]:u],u+=e),t(n,r,o,a,u,s)}}function t(e){return function(t,n,r){n=b(n,r);for(var o=E(t),i=e>0?0:o-1;i>=0&&i<o;i+=e)if(n(t[i],i,t))return i;return-1}}function n(e,t,n){return function(r,o,i){var a=0,s=E(r);if("number"==typeof i)e>0?a=i>=0?i:Math.max(i+s,a):s=i>=0?Math.min(i+1,s):i+s+1;else if(n&&i&&s)return i=n(r,o),r[i]===o?i:-1;if(o!==o)return i=t(l.call(r,a,s),y.isNaN),i>=0?i+a:-1;for(i=e>0?a:s-1;i>=0&&i<s;i+=e)if(r[i]===o)return i;return-1}}function r(e,t){var n=N.length,r=e.constructor,o=y.isFunction(r)&&r.prototype||s,i="constructor";for(y.has(e,i)&&!y.contains(t,i)&&t.push(i);n--;)i=N[n],i in e&&e[i]!==o[i]&&!y.contains(t,i)&&t.push(i)}var o=this,i=o._,a=Array.prototype,s=Object.prototype,u=Function.prototype,c=a.push,l=a.slice,f=s.toString,d=s.hasOwnProperty,p=Array.isArray,h=Object.keys,m=u.bind,v=Object.create,_=function(){},y=function(e){return e instanceof y?e:this instanceof y?void(this._wrapped=e):new y(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=y),exports._=y):o._=y,y.VERSION="1.8.3";var g=function(e,t,n){if(void 0===t)return e;switch(null==n?3:n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,o){return e.call(t,n,r,o)};case 4:return function(n,r,o,i){return e.call(t,n,r,o,i)}}return function(){return e.apply(t,arguments)}},b=function(e,t,n){return null==e?y.identity:y.isFunction(e)?g(e,t,n):y.isObject(e)?y.matcher(e):y.property(e)};y.iteratee=function(e,t){return b(e,t,1/0)};var w=function(e,t){return function(n){var r=arguments.length;if(r<2||null==n)return n;for(var o=1;o<r;o++)for(var i=arguments[o],a=e(i),s=a.length,u=0;u<s;u++){var c=a[u];t&&void 0!==n[c]||(n[c]=i[c])}return n}},T=function(e){if(!y.isObject(e))return{};if(v)return v(e);_.prototype=e;var t=new _;return _.prototype=null,t},k=function(e){return function(t){return null==t?void 0:t[e]}},x=Math.pow(2,53)-1,E=k("length"),M=function(e){var t=E(e);return"number"==typeof t&&t>=0&&t<=x};y.each=y.forEach=function(e,t,n){t=g(t,n);var r,o;if(M(e))for(r=0,o=e.length;r<o;r++)t(e[r],r,e);else{var i=y.keys(e);for(r=0,o=i.length;r<o;r++)t(e[i[r]],i[r],e)}return e},y.map=y.collect=function(e,t,n){t=b(t,n);for(var r=!M(e)&&y.keys(e),o=(r||e).length,i=Array(o),a=0;a<o;a++){var s=r?r[a]:a;i[a]=t(e[s],s,e)}return i},y.reduce=y.foldl=y.inject=e(1),y.reduceRight=y.foldr=e(-1),y.find=y.detect=function(e,t,n){var r;if(r=M(e)?y.findIndex(e,t,n):y.findKey(e,t,n),void 0!==r&&r!==-1)return e[r]},y.filter=y.select=function(e,t,n){var r=[];return t=b(t,n),y.each(e,function(e,n,o){t(e,n,o)&&r.push(e)}),r},y.reject=function(e,t,n){return y.filter(e,y.negate(b(t)),n)},y.every=y.all=function(e,t,n){t=b(t,n);for(var r=!M(e)&&y.keys(e),o=(r||e).length,i=0;i<o;i++){var a=r?r[i]:i;if(!t(e[a],a,e))return!1}return!0},y.some=y.any=function(e,t,n){t=b(t,n);for(var r=!M(e)&&y.keys(e),o=(r||e).length,i=0;i<o;i++){var a=r?r[i]:i;if(t(e[a],a,e))return!0}return!1},y.contains=y.includes=y.include=function(e,t,n,r){return M(e)||(e=y.values(e)),("number"!=typeof n||r)&&(n=0),y.indexOf(e,t,n)>=0},y.invoke=function(e,t){var n=l.call(arguments,2),r=y.isFunction(t);return y.map(e,function(e){var o=r?t:e[t];return null==o?o:o.apply(e,n)})},y.pluck=function(e,t){return y.map(e,y.property(t))},y.where=function(e,t){return y.filter(e,y.matcher(t))},y.findWhere=function(e,t){return y.find(e,y.matcher(t))},y.max=function(e,t,n){var r,o,i=-(1/0),a=-(1/0);if(null==t&&null!=e){e=M(e)?e:y.values(e);for(var s=0,u=e.length;s<u;s++)r=e[s],r>i&&(i=r)}else t=b(t,n),y.each(e,function(e,n,r){o=t(e,n,r),(o>a||o===-(1/0)&&i===-(1/0))&&(i=e,a=o)});return i},y.min=function(e,t,n){var r,o,i=1/0,a=1/0;if(null==t&&null!=e){e=M(e)?e:y.values(e);for(var s=0,u=e.length;s<u;s++)r=e[s],r<i&&(i=r)}else t=b(t,n),y.each(e,function(e,n,r){o=t(e,n,r),(o<a||o===1/0&&i===1/0)&&(i=e,a=o)});return i},y.shuffle=function(e){for(var t,n=M(e)?e:y.values(e),r=n.length,o=Array(r),i=0;i<r;i++)t=y.random(0,i),t!==i&&(o[i]=o[t]),o[t]=n[i];return o},y.sample=function(e,t,n){return null==t||n?(M(e)||(e=y.values(e)),e[y.random(e.length-1)]):y.shuffle(e).slice(0,Math.max(0,t))},y.sortBy=function(e,t,n){return t=b(t,n),y.pluck(y.map(e,function(e,n,r){return{value:e,index:n,criteria:t(e,n,r)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||void 0===n)return 1;if(n<r||void 0===r)return-1}return e.index-t.index}),"value")};var S=function(e){return function(t,n,r){var o={};return n=b(n,r),y.each(t,function(r,i){var a=n(r,i,t);e(o,r,a)}),o}};y.groupBy=S(function(e,t,n){y.has(e,n)?e[n].push(t):e[n]=[t]}),y.indexBy=S(function(e,t,n){e[n]=t}),y.countBy=S(function(e,t,n){y.has(e,n)?e[n]++:e[n]=1}),y.toArray=function(e){return e?y.isArray(e)?l.call(e):M(e)?y.map(e,y.identity):y.values(e):[]},y.size=function(e){return null==e?0:M(e)?e.length:y.keys(e).length},y.partition=function(e,t,n){t=b(t,n);var r=[],o=[];return y.each(e,function(e,n,i){(t(e,n,i)?r:o).push(e)}),[r,o]},y.first=y.head=y.take=function(e,t,n){if(null!=e)return null==t||n?e[0]:y.initial(e,e.length-t)},y.initial=function(e,t,n){return l.call(e,0,Math.max(0,e.length-(null==t||n?1:t)))},y.last=function(e,t,n){if(null!=e)return null==t||n?e[e.length-1]:y.rest(e,Math.max(0,e.length-t))},y.rest=y.tail=y.drop=function(e,t,n){return l.call(e,null==t||n?1:t)},y.compact=function(e){return y.filter(e,y.identity)};var O=function(e,t,n,r){for(var o=[],i=0,a=r||0,s=E(e);a<s;a++){var u=e[a];if(M(u)&&(y.isArray(u)||y.isArguments(u))){t||(u=O(u,t,n));var c=0,l=u.length;for(o.length+=l;c<l;)o[i++]=u[c++]}else n||(o[i++]=u)}return o};y.flatten=function(e,t){return O(e,t,!1)},y.without=function(e){return y.difference(e,l.call(arguments,1))},y.uniq=y.unique=function(e,t,n,r){y.isBoolean(t)||(r=n,n=t,t=!1),null!=n&&(n=b(n,r));for(var o=[],i=[],a=0,s=E(e);a<s;a++){var u=e[a],c=n?n(u,a,e):u;t?(a&&i===c||o.push(u),i=c):n?y.contains(i,c)||(i.push(c),o.push(u)):y.contains(o,u)||o.push(u)}return o},y.union=function(){return y.uniq(O(arguments,!0,!0))},y.intersection=function(e){for(var t=[],n=arguments.length,r=0,o=E(e);r<o;r++){var i=e[r];if(!y.contains(t,i)){for(var a=1;a<n&&y.contains(arguments[a],i);a++);a===n&&t.push(i)}}return t},y.difference=function(e){var t=O(arguments,!0,!0,1);return y.filter(e,function(e){return!y.contains(t,e)})},y.zip=function(){return y.unzip(arguments)},y.unzip=function(e){for(var t=e&&y.max(e,E).length||0,n=Array(t),r=0;r<t;r++)n[r]=y.pluck(e,r);return n},y.object=function(e,t){for(var n={},r=0,o=E(e);r<o;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},y.findIndex=t(1),y.findLastIndex=t(-1),y.sortedIndex=function(e,t,n,r){n=b(n,r,1);for(var o=n(t),i=0,a=E(e);i<a;){var s=Math.floor((i+a)/2);n(e[s])<o?i=s+1:a=s}return i},y.indexOf=n(1,y.findIndex,y.sortedIndex),y.lastIndexOf=n(-1,y.findLastIndex),y.range=function(e,t,n){null==t&&(t=e||0,e=0),n=n||1;for(var r=Math.max(Math.ceil((t-e)/n),0),o=Array(r),i=0;i<r;i++,e+=n)o[i]=e;return o};var A=function(e,t,n,r,o){if(!(r instanceof t))return e.apply(n,o);var i=T(e.prototype),a=e.apply(i,o);return y.isObject(a)?a:i};y.bind=function(e,t){if(m&&e.bind===m)return m.apply(e,l.call(arguments,1));if(!y.isFunction(e))throw new TypeError("Bind must be called on a function");var n=l.call(arguments,2),r=function(){return A(e,r,t,this,n.concat(l.call(arguments)))};return r},y.partial=function(e){var t=l.call(arguments,1),n=function(){for(var r=0,o=t.length,i=Array(o),a=0;a<o;a++)i[a]=t[a]===y?arguments[r++]:t[a];for(;r<arguments.length;)i.push(arguments[r++]);return A(e,n,this,this,i)};return n},y.bindAll=function(e){var t,n,r=arguments.length;if(r<=1)throw new Error("bindAll must be passed function names");for(t=1;t<r;t++)n=arguments[t],e[n]=y.bind(e[n],e);return e},y.memoize=function(e,t){var n=function(r){var o=n.cache,i=""+(t?t.apply(this,arguments):r);return y.has(o,i)||(o[i]=e.apply(this,arguments)),o[i]};return n.cache={},n},y.delay=function(e,t){var n=l.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},y.defer=y.partial(y.delay,y,1),y.throttle=function(e,t,n){var r,o,i,a=null,s=0;n||(n={});var u=function(){s=n.leading===!1?0:y.now(),a=null,i=e.apply(r,o),a||(r=o=null)};return function(){var c=y.now();s||n.leading!==!1||(s=c);var l=t-(c-s);return r=this,o=arguments,l<=0||l>t?(a&&(clearTimeout(a),a=null),s=c,i=e.apply(r,o),a||(r=o=null)):a||n.trailing===!1||(a=setTimeout(u,l)),i}},y.debounce=function(e,t,n){var r,o,i,a,s,u=function(){var c=y.now()-a;c<t&&c>=0?r=setTimeout(u,t-c):(r=null,n||(s=e.apply(i,o),r||(i=o=null)))};return function(){i=this,o=arguments,a=y.now();var c=n&&!r;return r||(r=setTimeout(u,t)),c&&(s=e.apply(i,o),i=o=null),s}},y.wrap=function(e,t){return y.partial(t,e)},y.negate=function(e){return function(){return!e.apply(this,arguments)}},y.compose=function(){var e=arguments,t=e.length-1;return function(){for(var n=t,r=e[t].apply(this,arguments);n--;)r=e[n].call(this,r);return r}},y.after=function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},y.before=function(e,t){var n;return function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=null),n}},y.once=y.partial(y.before,2);var C=!{toString:null}.propertyIsEnumerable("toString"),N=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];y.keys=function(e){if(!y.isObject(e))return[];if(h)return h(e);var t=[];for(var n in e)y.has(e,n)&&t.push(n);return C&&r(e,t),t},y.allKeys=function(e){if(!y.isObject(e))return[];var t=[];for(var n in e)t.push(n);return C&&r(e,t),t},y.values=function(e){for(var t=y.keys(e),n=t.length,r=Array(n),o=0;o<n;o++)r[o]=e[t[o]];return r},y.mapObject=function(e,t,n){t=b(t,n);for(var r,o=y.keys(e),i=o.length,a={},s=0;s<i;s++)r=o[s],a[r]=t(e[r],r,e);return a},y.pairs=function(e){for(var t=y.keys(e),n=t.length,r=Array(n),o=0;o<n;o++)r[o]=[t[o],e[t[o]]];return r},y.invert=function(e){for(var t={},n=y.keys(e),r=0,o=n.length;r<o;r++)t[e[n[r]]]=n[r];return t},y.functions=y.methods=function(e){var t=[];for(var n in e)y.isFunction(e[n])&&t.push(n);return t.sort()},y.extend=w(y.allKeys),y.extendOwn=y.assign=w(y.keys),y.findKey=function(e,t,n){t=b(t,n);for(var r,o=y.keys(e),i=0,a=o.length;i<a;i++)if(r=o[i],t(e[r],r,e))return r},y.pick=function(e,t,n){var r,o,i={},a=e;if(null==a)return i;y.isFunction(t)?(o=y.allKeys(a),r=g(t,n)):(o=O(arguments,!1,!1,1),r=function(e,t,n){return t in n},a=Object(a));for(var s=0,u=o.length;s<u;s++){var c=o[s],l=a[c];r(l,c,a)&&(i[c]=l)}return i},y.omit=function(e,t,n){if(y.isFunction(t))t=y.negate(t);else{var r=y.map(O(arguments,!1,!1,1),String);t=function(e,t){return!y.contains(r,t)}}return y.pick(e,t,n)},y.defaults=w(y.allKeys,!0),y.create=function(e,t){var n=T(e);return t&&y.extendOwn(n,t),n},y.clone=function(e){return y.isObject(e)?y.isArray(e)?e.slice():y.extend({},e):e},y.tap=function(e,t){return t(e),e},y.isMatch=function(e,t){var n=y.keys(t),r=n.length;if(null==e)return!r;for(var o=Object(e),i=0;i<r;i++){var a=n[i];if(t[a]!==o[a]||!(a in o))return!1}return!0};var D=function(e,t,n,r){if(e===t)return 0!==e||1/e===1/t;if(null==e||null==t)return e===t;e instanceof y&&(e=e._wrapped),t instanceof y&&(t=t._wrapped);var o=f.call(e);if(o!==f.call(t))return!1;switch(o){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!==+e?+t!==+t:0===+e?1/+e===1/t:+e===+t;case"[object Date]":case"[object Boolean]":return+e===+t}var i="[object Array]"===o;if(!i){if("object"!=typeof e||"object"!=typeof t)return!1;var a=e.constructor,s=t.constructor;if(a!==s&&!(y.isFunction(a)&&a instanceof a&&y.isFunction(s)&&s instanceof s)&&"constructor"in e&&"constructor"in t)return!1}n=n||[],r=r||[];for(var u=n.length;u--;)if(n[u]===e)return r[u]===t;if(n.push(e),r.push(t),i){if(u=e.length,u!==t.length)return!1;for(;u--;)if(!D(e[u],t[u],n,r))return!1}else{var c,l=y.keys(e);if(u=l.length,y.keys(t).length!==u)return!1;for(;u--;)if(c=l[u],!y.has(t,c)||!D(e[c],t[c],n,r))return!1}return n.pop(),r.pop(),!0};y.isEqual=function(e,t){return D(e,t)},y.isEmpty=function(e){return null==e||(M(e)&&(y.isArray(e)||y.isString(e)||y.isArguments(e))?0===e.length:0===y.keys(e).length)},y.isElement=function(e){return!(!e||1!==e.nodeType)},y.isArray=p||function(e){return"[object Array]"===f.call(e)},y.isObject=function(e){var t=typeof e;return"function"===t||"object"===t&&!!e},y.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(e){y["is"+e]=function(t){return f.call(t)==="[object "+e+"]"}}),y.isArguments(arguments)||(y.isArguments=function(e){return y.has(e,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(y.isFunction=function(e){return"function"==typeof e||!1}),y.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},y.isNaN=function(e){return y.isNumber(e)&&e!==+e},y.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"===f.call(e)},y.isNull=function(e){return null===e},y.isUndefined=function(e){return void 0===e},y.has=function(e,t){return null!=e&&d.call(e,t)},y.noConflict=function(){return o._=i,this},y.identity=function(e){return e},y.constant=function(e){return function(){return e}},y.noop=function(){},y.property=k,y.propertyOf=function(e){return null==e?function(){}:function(t){return e[t]}},y.matcher=y.matches=function(e){return e=y.extendOwn({},e),function(t){return y.isMatch(t,e)}},y.times=function(e,t,n){var r=Array(Math.max(0,e));t=g(t,n,1);for(var o=0;o<e;o++)r[o]=t(o);return r},y.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},y.now=Date.now||function(){return(new Date).getTime()};var j={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},I=y.invert(j),L=function(e){var t=function(t){return e[t]},n="(?:"+y.keys(e).join("|")+")",r=RegExp(n),o=RegExp(n,"g");return function(e){return e=null==e?"":""+e,r.test(e)?e.replace(o,t):e}};y.escape=L(j),y.unescape=L(I),y.result=function(e,t,n){var r=null==e?void 0:e[t];return void 0===r&&(r=n),y.isFunction(r)?r.call(e):r};var U=0;y.uniqueId=function(e){var t=++U+"";return e?e+t:t},y.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var B=/(.)^/,W={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},H=/\\|'|\r|\n|\u2028|\u2029/g,P=function(e){return"\\"+W[e]};y.template=function(e,t,n){!t&&n&&(t=n),t=y.defaults({},t,y.templateSettings);var r=RegExp([(t.escape||B).source,(t.interpolate||B).source,(t.evaluate||B).source].join("|")+"|$","g"),o=0,i="__p+='";e.replace(r,function(t,n,r,a,s){return i+=e.slice(o,s).replace(H,P),o=s+t.length,n?i+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":r?i+="'+\n((__t=("+r+"))==null?'':__t)+\n'":a&&(i+="';\n"+a+"\n__p+='"),t}),i+="';\n",t.variable||(i="with(obj||{}){\n"+i+"}\n"),i="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+i+"return __p;\n";try{var a=new Function(t.variable||"obj","_",i)}catch(e){throw e.source=i,e}var s=function(e){return a.call(this,e,y)},u=t.variable||"obj";return s.source="function("+u+"){\n"+i+"}",s},y.chain=function(e){var t=y(e);return t._chain=!0,t};var F=function(e,t){return e._chain?y(t).chain():t};y.mixin=function(e){y.each(y.functions(e),function(t){var n=y[t]=e[t];y.prototype[t]=function(){var e=[this._wrapped];return c.apply(e,arguments),F(this,n.apply(y,e))}})},y.mixin(y),y.each(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=a[e];y.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!==e&&"splice"!==e||0!==n.length||delete n[0],F(this,n)}}),y.each(["concat","join","slice"],function(e){var t=a[e];y.prototype[e]=function(){return F(this,t.apply(this._wrapped,arguments))}}),y.prototype.value=function(){return this._wrapped},y.prototype.valueOf=y.prototype.toJSON=y.prototype.value,y.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return y})}.call(this),define("server/db/sql_table",["underscore"],function(e){var t=function(){function t(e,t){this._database=e,this._schema=t,this._name=t.name}return t.prototype.load=function(e,t){var n,r,o,i,a,s,u;for(r="",s=this._schema.columns,i=0,a=s.length;i<a;i++)n=s[i],r&&(r+=", "),r+=" "+n.name+" "+n.type,n.primaryKey&&(r+=" PRIMARY KEY");return u=function(){"function"==typeof e&&e()},o=function(e,n){"function"==typeof t&&t(n)},this._database.transaction(function(e){return function(t){return t.executeSql("CREATE TABLE IF NOT EXISTS "+e._name+" ("+r+")",[],u,o)}}(this))},t.prototype.drop=function(e,t){return this._executeSql("DROP TABLE "+this._name,[],e,t)},t.prototype.create=function(e,t,n){return this.createAll([e],t,n)},t.prototype.createAll=function(e,t,n){var r,o,i;return i=null,r=0,o=e.length-1,this._database.transaction(function(a){return function(s){var u,c,l,f,d,p;for(d=[],c=0,l=e.length;c<l;c++)f=e[c],r===o&&(i=t),r++,u=a._createColumnValueParams(f),p=a._valuesFromModel(f),d.push(s.executeSql("INSERT OR IGNORE INTO "+a._name+" "+u,p,i,n));return d}}(this))},t.prototype.destroyAll=function(e,t){return this._executeSql("DELETE FROM "+this._name,[],e,t)},t.prototype.findAll=function(e,t){var n;return n=function(n,r){var o,i,a;return a=r.rows,i=a.length,i?e(function(){var e,t,n;for(n=[],o=e=t=i-1;t<=0?e<=0:e>=0;o=t<=0?++e:--e)n.push(a.item(o));return n}()):t()},this._executeSql("SELECT * FROM "+this._name,[],n,t)},t.prototype._executeSql=function(e,t,n,r){var o,i;return i=function(e,t){"function"==typeof n&&n(e,t)},o=function(e,t){"function"==typeof r&&r(e,t)},this._database.transaction(function(n){return n.executeSql(e,t,i,o)})},t.prototype._valuesFromModel=function(t){var n,r,o;o=[];for(n in t)r=t[n],e.isObject(r)&&(r=JSON.stringify(r)),o.push(r);return o},t.prototype._createColumnValueParams=function(e){var t,n,r;t="",r="";for(n in e)t&&(t+=","),t+=n,r&&(r+=","),r+="?";return"("+t+") VALUES ("+r+")"},t}();return t}),define("server/db/database_websql",["server/db/sql_table","underscore"],function(e,t){var n=function(){function n(e){this._options=e}return n.prototype.open=function(){var e;return e=function(e){return function(){var t,n;try{t=window.openDatabase(e._options.name,"",e._options.displayName,e._options.maxSize)}catch(t){return n=t,void e._options.error({open:!0})}return t.version!==e._options.version?e._migrate(t):e._loadTables(t)}}(this),t.delay(e,this._options.delay)},n.prototype.close=function(){},n.prototype._loadTables=function(t){var n,r,o,i,a,s,u,c,l,f;for(c=0,r=!1,l=function(e){return function(){if(c++,e._options.schema.webSQL.length===c)return e._options.success(e)}}(this),n=function(e){return function(){if(!r)return r=!0,e._options.error({load:!0})}}(this),a=this._options.schema.webSQL,s=[],o=0,i=a.length;o<i;o++)u=a[o],f=new e(t,u),f.load(l,n),s.push(this[u.name]=f);return s},n.prototype._migrate=function(e){var t,n,r,o,i;return n=!1,i=function(e){return function(n){return e._dropTables(n,t)}}(this),t=function(e){return function(){return!!n||(n=!0,e._options.error({migrate:!0}),!0)}}(this),o=function(t){return function(){return r?t._options.error({forceRefresh:!0}):t._loadTables(e)}}(this),r=e.version,e.changeVersion(e.version,this._options.version,i,t,o)},n.prototype._dropTables=function(e,t){var n;return n=function(n,r){var o,i,a,s,u,c;if(c=r.rows,a=c.length,!(a<=0))for(i=o=0,s=a-1;0<=s?o<=s:o>=s;i=0<=s?++o:--o)u=c.item(i),0!==u.name.indexOf("__")&&e.executeSql("DROP TABLE "+u.name,[],null,t)},e.executeSql("SELECT * FROM sqlite_master WHERE type='table'",[],n,t)},n}();return n}),define("server/db/object_store",[],function(){var e,t,n,r=window.IDBObjectStore||window.webkitIDBObjectStore||window.mozIDBObjectStore||window.msIDBObjectStore,o=function(){function n(e,t){this._database=e,this._schema=t,this._name=t.name}return n.prototype.drop=function(e,t,n){return n||(n=!0),this._execute("_clear",null,e,t,n)},n.prototype.create=function(e,t,n,r){return this.createAll([e],t,n,r)},n.prototype.createAll=function(n,r,o,i){var a,s,u,c,l;for(l=this._getTransaction(),c=l.objectStore(this._name),a=0,s=n.length;a<s;a++)u=n[a],c.put(u);return l.oncomplete=r,l.onabort=function(t){return e(t,i)},l.onerror=function(){return t(null,o)},l.onerror},n.prototype.destroyAll=function(e,t){return this._execute("_clear",null,e,t)},n.prototype.findAll=function(e,t){var n;return"undefined"!=typeof r.prototype.getAll||"undefined"!=typeof r.prototype.mozGetAll?this._execute("_findAllNative",null,e,t):(n=function(){return!0},this._executeIndex("_findAll",null,e,t,n,!0))},n.prototype._clear=function(e,t){return t.clear()},n.prototype._findAllNative=function(e,t){if("function"==typeof t.getAll)return t.getAll();if("function"==typeof t.mozGetAll)return t.mozGetAll();throw new Error("object store getAll not supported")},n.prototype._findAll=function(e,t){return t.openCursor(null,"prev")},n.prototype._startTransaction=function(){return this._database.transaction([this._name],"readwrite").objectStore(this._name)},n.prototype._startReadTransaction=function(){return this._database.transaction([this._name],"readonly").objectStore(this._name)},n.prototype._getTransaction=function(){return this._database.transaction([this._name],"readwrite")},n.prototype._execute=function(e,n,r,o,i){var a,s;return s=this._startTransaction(),a=this[e](n,s),a.onsuccess=function(e){var t;t=a.result,i||t||"done"===a.readyState?"function"==typeof r&&r(t):"function"==typeof o&&o(e)},a.onerror=function(e){return t(e,o)},a.onerror},n.prototype._executeIndex=function(e,n,r,o,i,a){var s,u,c;return"undefined"==typeof i&&(i=function(){return!0}),c=a?this._startReadTransaction():this._startTransaction(),u=[],s=this[e](n,c),s.onsuccess=function(e){var t,n;return(t=e.target.result)?(n=t.value,i(n)&&u.push(n),t.continue()):void(u.length?"function"==typeof r&&r(u):"function"==typeof o&&o())},s.onerror=function(e){return t(e,o)},s.onerror},n}();return t=function(e,t){var n;return n=!1,t&&(t(e),n=!0),n},e=function(e,t){"function"==typeof t&&t({overlimit:n(e)})},n=function(e){var t="";return null!==e&&null!==e.currentTarget&&null!==e.currentTarget.error&&null!==e.currentTarget.name&&(t=e.currentTarget.error.name),"QuotaExceededError"===t||"AbortError"===t},o}),define("server/db/database_indexeddb",["server/db/object_store","underscore"],function(e,t){var n=function(){function n(e){this._options=e}return n.prototype.open=function(){var e,t;try{e=n.indexedDB.open(this._options.name,parseInt(this._options.version))}catch(e){return t=e,void this._options.error({open:!0})}return e.onerror=function(e){return function(){return e._options.error({open:!0}),!0}}(this),e.onsuccess=function(e){return function(t){return e._database=t.target.result,e._loadStores(),e._options.success(e),!0}}(this),e.onupgradeneeded=function(e){return function(t){return e._database=t.target.result,e._migrate(),!0}}(this),e},n.prototype.close=function(){var e;null!==(e=this._database)&&e.close(),this._database=void 0},n.prototype._migrate=function(){var e,t,n,r,o,i;if(o=this._database.objectStoreNames,n=o.length,0<n)for(t=e=0,i=n-1;0<=i?e<=i:e>=i;t=0<=i?++e:--e)r=o.item(t),this._database.deleteObjectStore(r);return this._createStores()},n.prototype._createStores=function(){
var e,t,n,r;for(n=this._options.schema.indexedDB,e=0,t=n.length;e<t;e++)r=n[e],this._database.createObjectStore(r.name,r.options)},n.prototype._loadStores=function(){var t,n,r,o,i,a,s;if(i=this._database.objectStoreNames,r=i.length-1,!(r<0))for(n=t=0,a=r;0<=a?t<=a:t>=a;n=0<=a?++t:--t)o=i.item(n),s=this._schemaForName(o),this[o]=new e(this._database,s)},n.prototype._schemaForName=function(e){var n=t.find(this._options.schema.indexedDB,function(t){if(t.name===e)return t});return n},n.indexedDB=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.OIndexedDB||window.msIndexedDB,n}();return n}),define("server/db/database",["server/db/database_websql","server/db/database_indexeddb"],function(e,t){var n={open:function(n){var r;return r=n.useIndexedDB?new t(n):new e(n),r.open(),r}};return n}),define("server/db/database_helper",[],function(){var e={supported:function(){return e.indexedDbSupported()||e.webSQLSupported()},webSQLSupported:function(){return!!window.openDatabase},indexedDbSupported:function(){return!!window.indexedDB}};return e}),define("utils/logger",[],function(){function e(e){this._enabled=e,this._enabledDebug=e,this._enabledInfo=e,this._enabledWarn=e,this._enabledError=e,this._cacheNativeConsoleMethods(),this._enabled||this.disableConsole()}e.CONSOLE_METHODS=["log","debug","info","warn","assert","dir","dirxml","group","groupEnd","time","timeEnd","count","trace","profile","profileEnd"];var t=[].slice;return e.prototype.disableDebug=function(e){null!==e&&void 0!==e||(e=!0),this._enabledDebug=!e},e.prototype.disableInfo=function(e){null!==e&&void 0!==e||(e=!0),this._enabledInfo=!e},e.prototype.disableWarn=function(e){null!==e&&void 0!==e||(e=!0),this._enabledWarn=!e},e.prototype.disableError=function(e){null!==e&&void 0!==e||(e=!0),this._enabledError=!e},e.prototype.debug=function(){var e,n;e=arguments[0],n=2<=arguments.length?t.call(arguments,1):[],this._enabled&&this._enabledDebug&&(e=this._formatMessage("DEBUG",e),console.log.apply(console,[e].concat(t.call(n))))},e.prototype.info=function(){var e,n;e=arguments[0],n=2<=arguments.length?t.call(arguments,1):[],this._enabled&&this._enabledInfo&&(e=this._formatMessage("INFO",e),console.log.apply(console,[e].concat(t.call(n))))},e.prototype.warn=function(){var e,n;e=arguments[0],n=2<=arguments.length?t.call(arguments,1):[],this._enabled&&this._enabledWarn&&(e=this._formatMessage("WARN",e),console.warn.apply(console,[e].concat(t.call(n))))},e.prototype.error=function(){var e,n;e=arguments[0],n=2<=arguments.length?t.call(arguments,1):[],this._enabled&&this._enabledError&&(e=this._formatMessage("ERROR",e),console.error.apply(console,[e].concat(t.call(n))))},e.prototype._formatMessage=function(e,t){var n;return n=this.formatTime(),"["+e+"] "+n+": "+t},e.prototype._cacheNativeConsoleMethods=function(){var t,n,r,o;for(this._nativeConsoleMethods={},o=e.CONSOLE_METHODS,t=0,n=o.length;t<n;t++)r=o[t],this._nativeConsoleMethods[r]=console[r]},e.prototype.enableConsole=function(){var t,n,r,o;if(this._nativeConsoleMethods)for(o=e.CONSOLE_METHODS,t=0,n=o.length;t<n;t++)r=o[t],console[r]=this._nativeConsoleMethods[r]},e.prototype.disableConsole=function(){var t,n,r,o;for(o=e.CONSOLE_METHODS,t=0,n=o.length;t<n;t++)r=o[t],console[r]=function(){}},e.prototype.formatTime=function(e){e||(e=new Date);var t=this.pad(e.getHours(),2),n=this.pad(e.getMinutes(),2),r=this.pad(e.getSeconds(),2),o=this.pad(e.getMilliseconds(),2);return t+":"+n+":"+r+":"+o},e.prototype.pad=function(e,t,n){for(n||(n="0"),e=String(e);e.length<t;)e=n+e;return e},e}),function(e){var t=!1;if("function"==typeof define&&define.amd&&(define("Cookies",e),t=!0),"object"==typeof exports&&(module.exports=e(),t=!0),!t){var n=window.Cookies,r=window.Cookies=e();r.noConflict=function(){return window.Cookies=n,r}}}(function(){function e(){for(var e=0,t={};e<arguments.length;e++){var n=arguments[e];for(var r in n)t[r]=n[r]}return t}function t(n){function r(t,o,i){var a;if("undefined"!=typeof document){if(arguments.length>1){if(i=e({path:"/"},r.defaults,i),"number"==typeof i.expires){var s=new Date;s.setMilliseconds(s.getMilliseconds()+864e5*i.expires),i.expires=s}i.expires=i.expires?i.expires.toUTCString():"";try{a=JSON.stringify(o),/^[\{\[]/.test(a)&&(o=a)}catch(e){}o=n.write?n.write(o,t):encodeURIComponent(String(o)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)),t=t.replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent),t=t.replace(/[\(\)]/g,escape);var u="";for(var c in i)i[c]&&(u+="; "+c,i[c]!==!0&&(u+="="+i[c]));return document.cookie=t+"="+o+u}t||(a={});for(var l=document.cookie?document.cookie.split("; "):[],f=/(%[0-9A-Z]{2})+/g,d=0;d<l.length;d++){var p=l[d].split("="),h=p.slice(1).join("=");'"'===h.charAt(0)&&(h=h.slice(1,-1));try{var m=p[0].replace(f,decodeURIComponent);if(h=n.read?n.read(h,m):n(h,m)||h.replace(f,decodeURIComponent),this.json)try{h=JSON.parse(h)}catch(e){}if(t===m){a=h;break}t||(a[m]=h)}catch(e){}}return a}}return r.set=r,r.get=function(e){return r.call(r,e)},r.getJSON=function(){return r.apply({json:!0},[].slice.call(arguments))},r.defaults={},r.remove=function(t,n){r(t,"",e(n,{expires:-1}))},r.withConverter=t,r}return t(function(){})}),!function(e,t,n){"undefined"!=typeof module&&module.exports?module.exports=n():"function"==typeof define&&define.amd?define(t,n):e[t]=n()}(this,"bowser",function(){function e(e){function t(t){var n=e.match(t);return n&&n.length>1&&n[1]||""}function n(t){var n=e.match(t);return n&&n.length>1&&n[2]||""}function r(e){switch(e){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}var o,i=t(/(ipod|iphone|ipad)/i).toLowerCase(),s=/like android/i.test(e),u=!s&&/android/i.test(e),c=/nexus\s*[0-6]\s*/i.test(e),l=!c&&/nexus\s*[0-9]+/i.test(e),f=/CrOS/.test(e),d=/silk/i.test(e),p=/sailfish/i.test(e),h=/tizen/i.test(e),m=/(web|hpw)os/i.test(e),v=/windows phone/i.test(e),_=(/SamsungBrowser/i.test(e),!v&&/windows/i.test(e)),y=!i&&!d&&/macintosh/i.test(e),g=!u&&!p&&!h&&!m&&/linux/i.test(e),b=t(/edge\/(\d+(\.\d+)?)/i),w=t(/version\/(\d+(\.\d+)?)/i),T=/tablet/i.test(e)&&!/tablet pc/i.test(e),k=!T&&/[^-]mobi/i.test(e),x=/xbox/i.test(e);/opera/i.test(e)?o={name:"Opera",opera:a,version:w||t(/(?:opera|opr|opios)[\s\/](\d+(\.\d+)?)/i)}:/opr|opios/i.test(e)?o={name:"Opera",opera:a,version:t(/(?:opr|opios)[\s\/](\d+(\.\d+)?)/i)||w}:/SamsungBrowser/i.test(e)?o={name:"Samsung Internet for Android",samsungBrowser:a,version:w||t(/(?:SamsungBrowser)[\s\/](\d+(\.\d+)?)/i)}:/coast/i.test(e)?o={name:"Opera Coast",coast:a,version:w||t(/(?:coast)[\s\/](\d+(\.\d+)?)/i)}:/yabrowser/i.test(e)?o={name:"Yandex Browser",yandexbrowser:a,version:w||t(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}:/ucbrowser/i.test(e)?o={name:"UC Browser",ucbrowser:a,version:t(/(?:ucbrowser)[\s\/](\d+(?:\.\d+)+)/i)}:/mxios/i.test(e)?o={name:"Maxthon",maxthon:a,version:t(/(?:mxios)[\s\/](\d+(?:\.\d+)+)/i)}:/epiphany/i.test(e)?o={name:"Epiphany",epiphany:a,version:t(/(?:epiphany)[\s\/](\d+(?:\.\d+)+)/i)}:/puffin/i.test(e)?o={name:"Puffin",puffin:a,version:t(/(?:puffin)[\s\/](\d+(?:\.\d+)?)/i)}:/sleipnir/i.test(e)?o={name:"Sleipnir",sleipnir:a,version:t(/(?:sleipnir)[\s\/](\d+(?:\.\d+)+)/i)}:/k-meleon/i.test(e)?o={name:"K-Meleon",kMeleon:a,version:t(/(?:k-meleon)[\s\/](\d+(?:\.\d+)+)/i)}:v?(o={name:"Windows Phone",windowsphone:a},b?(o.msedge=a,o.version=b):(o.msie=a,o.version=t(/iemobile\/(\d+(\.\d+)?)/i))):/msie|trident/i.test(e)?o={name:"Internet Explorer",msie:a,version:t(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:f?o={name:"Chrome",chromeos:a,chromeBook:a,chrome:a,version:t(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:/chrome.+? edge/i.test(e)?o={name:"Microsoft Edge",msedge:a,version:b}:/vivaldi/i.test(e)?o={name:"Vivaldi",vivaldi:a,version:t(/vivaldi\/(\d+(\.\d+)?)/i)||w}:p?o={name:"Sailfish",sailfish:a,version:t(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(e)?o={name:"SeaMonkey",seamonkey:a,version:t(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel|fxios/i.test(e)?(o={name:"Firefox",firefox:a,version:t(/(?:firefox|iceweasel|fxios)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(e)&&(o.firefoxos=a)):d?o={name:"Amazon Silk",silk:a,version:t(/silk\/(\d+(\.\d+)?)/i)}:/phantom/i.test(e)?o={name:"PhantomJS",phantom:a,version:t(/phantomjs\/(\d+(\.\d+)?)/i)}:/slimerjs/i.test(e)?o={name:"SlimerJS",slimer:a,version:t(/slimerjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(e)||/rim\stablet/i.test(e)?o={name:"BlackBerry",blackberry:a,version:w||t(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:m?(o={name:"WebOS",webos:a,version:w||t(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(e)&&(o.touchpad=a)):/bada/i.test(e)?o={name:"Bada",bada:a,version:t(/dolfin\/(\d+(\.\d+)?)/i)}:h?o={name:"Tizen",tizen:a,version:t(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||w}:/qupzilla/i.test(e)?o={name:"QupZilla",qupzilla:a,version:t(/(?:qupzilla)[\s\/](\d+(?:\.\d+)+)/i)||w}:/chromium/i.test(e)?o={name:"Chromium",chromium:a,version:t(/(?:chromium)[\s\/](\d+(?:\.\d+)?)/i)||w}:/chrome|crios|crmo/i.test(e)?o={name:"Chrome",chrome:a,version:t(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:u?o={name:"Android",version:w}:/safari|applewebkit/i.test(e)?(o={name:"Safari",safari:a},w&&(o.version=w)):i?(o={name:"iphone"==i?"iPhone":"ipad"==i?"iPad":"iPod"},w&&(o.version=w)):o=/googlebot/i.test(e)?{name:"Googlebot",googlebot:a,version:t(/googlebot\/(\d+(\.\d+))/i)||w}:{name:t(/^(.*)\/(.*) /),version:n(/^(.*)\/(.*) /)},!o.msedge&&/(apple)?webkit/i.test(e)?(/(apple)?webkit\/537\.36/i.test(e)?(o.name=o.name||"Blink",o.blink=a):(o.name=o.name||"Webkit",o.webkit=a),!o.version&&w&&(o.version=w)):!o.opera&&/gecko\//i.test(e)&&(o.name=o.name||"Gecko",o.gecko=a,o.version=o.version||t(/gecko\/(\d+(\.\d+)?)/i)),o.windowsphone||o.msedge||!u&&!o.silk?o.windowsphone||o.msedge||!i?y?o.mac=a:x?o.xbox=a:_?o.windows=a:g&&(o.linux=a):(o[i]=a,o.ios=a):o.android=a;var E="";o.windows?E=r(t(/Windows ((NT|XP)( \d\d?.\d)?)/i)):o.windowsphone?E=t(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):o.mac?(E=t(/Mac OS X (\d+([_\.\s]\d+)*)/i),E=E.replace(/[_\s]/g,".")):i?(E=t(/os (\d+([_\s]\d+)*) like mac os x/i),E=E.replace(/[_\s]/g,".")):u?E=t(/android[ \/-](\d+(\.\d+)*)/i):o.webos?E=t(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):o.blackberry?E=t(/rim\stablet\sos\s(\d+(\.\d+)*)/i):o.bada?E=t(/bada\/(\d+(\.\d+)*)/i):o.tizen&&(E=t(/tizen[\/\s](\d+(\.\d+)*)/i)),E&&(o.osversion=E);var M=!o.windows&&E.split(".")[0];return T||l||"ipad"==i||u&&(3==M||M>=4&&!k)||o.silk?o.tablet=a:(k||"iphone"==i||"ipod"==i||u||c||o.blackberry||o.webos||o.bada)&&(o.mobile=a),o.msedge||o.msie&&o.version>=10||o.yandexbrowser&&o.version>=15||o.vivaldi&&o.version>=1||o.chrome&&o.version>=20||o.samsungBrowser&&o.version>=4||o.firefox&&o.version>=20||o.safari&&o.version>=6||o.opera&&o.version>=10||o.ios&&o.osversion&&o.osversion.split(".")[0]>=6||o.blackberry&&o.version>=10.1||o.chromium&&o.version>=20?o.a=a:o.msie&&o.version<10||o.chrome&&o.version<20||o.firefox&&o.version<20||o.safari&&o.version<6||o.opera&&o.version<10||o.ios&&o.osversion&&o.osversion.split(".")[0]<6||o.chromium&&o.version<20?o.c=a:o.x=a,o}function t(e){return e.split(".").length}function n(e,t){var n,r=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(n=0;n<e.length;n++)r.push(t(e[n]));return r}function r(e){for(var r=Math.max(t(e[0]),t(e[1])),o=n(e,function(e){var o=r-t(e);return e+=new Array(o+1).join(".0"),n(e.split("."),function(e){return new Array(20-e.length).join("0")+e}).reverse()});--r>=0;){if(o[0][r]>o[1][r])return 1;if(o[0][r]!==o[1][r])return-1;if(0===r)return 0}}function o(t,n,o){var i=s;"string"==typeof n&&(o=n,n=void 0),void 0===n&&(n=!1),o&&(i=e(o));var a=""+i.version;for(var u in t)if(t.hasOwnProperty(u)&&i[u]){if("string"!=typeof t[u])throw new Error("Browser version in the minVersion map should be a string: "+u+": "+String(t));return r([a,t[u]])<0}return n}function i(e,t,n){return!o(e,t,n)}var a=!0,s=e("undefined"!=typeof navigator?navigator.userAgent||"":"");return s.test=function(e){for(var t=0;t<e.length;++t){var n=e[t];if("string"==typeof n&&n in s)return!0}return!1},s.isUnsupportedBrowser=o,s.compareVersions=r,s.check=i,s._detect=e,s}),define("bowser",function(){}),define("server/db/app_database",["server/db/database","server/db/database_helper","utils/logger","Cookies","bowser","underscore"],function(e,t,n,r,o,i){function a(){this._firstTime=!this._getValidUntilCookie(),this.bowser=require("bowser"),this.logger=new n(!0)}return a.supported=function(){return t.supported()},a.prototype.clear=function(e){return null===this._database?void("function"==typeof e&&e()):this._database.moments.drop(e,e)},a.prototype.load=function(e,t,n,r,o){return this._onFirstTime=t,this._onPreLoadComplete=n,this._onComplete=r,this._onError=o,this.lifeUid=e.lifeUid,this._open()},a.prototype.deleteMoments=function(e,t){return null===this._database?void("function"==typeof t&&t()):this._database.moments.destroyAll(e,t)},a.prototype.saveMoments=function(e,t,n,r,o){var i,a,s,u;return u=function(){"function"==typeof n&&n()},s=function(e){return function(t){e.logger.warn("saving moments to the database failed",t),"function"==typeof r&&r(t)}}(this),i=function(e){return function(t){e.logger.warn("saving moments to the database was aborted",t),"function"==typeof o&&o(t)}}(this),a=function(n){return function(){return n._database.moments.create({hex:e,date:t},u,s,i)}}(this),this._database.moments.destroyAll(a,s)},a.prototype._open=function(){var n;return this._firstTime&&"function"==typeof this._onFirstTime&&this._onFirstTime(),n={name:this.lifeUid,displayName:"ThisLife Database",version:"10",maxSize:52428800,delay:this._firstTime?250:0,useIndexedDB:t.indexedDbSupported(),schema:{webSQL:[{name:"moments",columns:[{name:"hex",type:"text"},{name:"date",type:"integer"}]}],indexedDB:[{name:"moments",options:{autoIncrement:!0}}]},success:i.bind(this._openSuccessHandler,this),error:i.bind(this._openErrorHandler,this)},e.open(n)},a.prototype._openSuccessHandler=function(e){var t,n;return this._database=e,this._updateValidUntilCookie(),this._onPreLoadComplete(),n=function(e){return function(t){var n,r,o;return o=null!==t&&t.length?t[0]:null,null!==o&&o.hasOwnProperty("hex")&&(n=o.hex),null!==o&&o.hasOwnProperty("date")&&(r=o.date),e._onComplete(n,r)}}(this),t=function(e){return function(){return e._onComplete()}}(this),this._database.moments.findAll(n,t)},a.prototype._openErrorHandler=function(e){return this._onError(e)},a.prototype._updateValidUntilCookie=function(){var e,t;if(!this._getValidUntilCookie())return e=new Date,t=new Date(e.setYear(e.getFullYear()+1)),r.set("localdb",!0,{expiresAt:t})},a.prototype._getValidUntilCookie=function(){return r.get("localdb")},a}),define("utils/time_tracker",[],function(){function e(){this.metrics={}}return e.prototype.start=function(e){this.metrics[e]={},this.metrics[e].startTime=performance.now()},e.prototype.end=function(e){if(!this.metrics[e])return null;var t=performance.now()-this.metrics[e].startTime;return delete this.metrics[e],t},e}),define("server/moment_sync",["common/moment_loader/hex/moment_hex","server/worker_factory","server/db/database_helper","server/moment_loader_server","utils/time_tracker","underscore"],function(e,t,n,r,o,i){function a(e){this._database=e.database,this._apiUrl=e.apiUrl,this._oauthToken=e.oauthToken,this._lifeUid=e.lifeUid,this.timeTracker=new o,this.performance=[]}return a.prototype.start=function(t,n,r,o){var i;return this._onComplete=r,this._onError=o,i=new e,this._startCount=i.momentCount(t),this._startCount&&!n?this._database.clear(function(e){return function(){return e._fetchAll()}}(this)):this._startCount?this._fetchChangesSince(t,n):this._fetchAll()},a.prototype._fetchChangesSince=function(e,n){this.timeTracker.start("fetchChangesSince");var r=function(e){return function(t){return e.performance.push({name:"fetchChangesSince",value:e.timeTracker.end("fetchChangesSince")}),e._workerCompleteHandler(t)}}(this);return t.createMomentsSinceWorker(e,n,this._apiUrl,this._oauthToken,this._lifeUid,r,i.bind(this._workerErrorHandler,this))},a.prototype._fetchAll=function(){this.timeTracker.start("fetchAll");var e,r,o=this;return r=function(e){return o.performance.push({name:"fetchAll",value:o.timeTracker.end("fetchAll")}),o._workerCompleteHandler(e)},e=n.supported(),t.createAllMomentsWorker(o._apiUrl,e,o._oauthToken,o._lifeUid,r,i.bind(o._workerErrorHandler,o))},a.prototype._workerCompleteHandler=function(e){var t=e.time;return this._database&&e.anyChanges&&this._database.saveMoments(e.momentsHex,t),i.extend(e,{performance:this.performance}),this._onComplete(e)},a.prototype._workerErrorHandler=function(e){return this._onError(e.message||e.data)},a}),define("utils/string_utils",[],{replace:function(e,t){for(var n=0;n<t.length;n++)reg=new RegExp("\\{"+n+"\\}","gm"),e=e.replace(reg,t[n]);return e},getProtocol:function(){return window.location.protocol}}),define("server/moment_loader_server",["server/worker_factory","server/db/app_database","server/db/database_helper","server/moment_sync","utils/string_utils","utils/logger","utils/time_tracker","underscore"],function(e,t,n,r,o,i,a,s){var u={_oauthToken:null,_lifeUid:null,_apiUrl:null,_options:null,_momentData:[],_onCompleteCb:null,_onErrorCb:null,_database:null,setParamsAndLoad:function(e,t,n){u._oauthToken=e.oauthToken,u._lifeUid=e.lifeUid,u._env="prod"===e.env?"":e.env+".",u._onCompleteCb=t,u._onErrorCb=n,u._apiUrl=o.replace("//cmd.{0}thislife.com/json",[u._env]),u._timeTracker=new a,u._performance=[],u.load()},loadData:function(e,r,o){u._options=e,n.supported()&&!u._database&&(u._database=new t),u._oauthToken&&u._oauthToken!==e.oauthToken||u._lifeUid&&u._lifeUid!==e.lifeUid?this._database.clear(function(e){return function(){u.setParamsAndLoad(u._options,r,o)}}(this)):u.setParamsAndLoad(u._options,r,o)},filter:function(e,t,n){var r,o=e.attribute,i=parseInt(e.isRange),a=e.values;return i&&2!=e.values.length?void n("Please pass valid range values in"):(r=i?s.filter(u._momentData,function(e){return e[o]>=a[0]&&e[o]<=a[1]}):s.filter(u._momentData,function(e){return s.indexOf(a,e[o])!==-1}),void t({moments:r}))},refresh:function(e,t){u._onCompleteCb=e,u._onErrorCb=t,successCb=function(){u._momentData=[],u._fetchData()},errorCb=function(e,t){u._onErrorCb(t)},u._database&&u._oauthToken&&u._lifeUid&&u._apiUrl?u._database.deleteMoments(successCb,errorCb):u._onErrorCb("Unable to refresh moments")},clear:function(e){u._database&&u._database.clear(function(t){return function(){u._momentData=[],u._oauthToken=null,u._lifeUid=null,u._onCompleteCb=null,u._onErrorCb=null,u._apiUrl=null,e("data cleared successfully")}}(this))},load:function(){var e,t,n,r;return n=function(){},r=function(){u._performance.push({name:"openDatabase",value:u._timeTracker.end("openDatabase")}),u._timeTracker.start("loadData")},e=function(e,t){u._performance.push({name:"loadData",value:u._timeTracker.end("loadData")}),u._fetchData(e,t)},t=function(e){u._onMomentSyncError(e)},u._timeTracker.start("openDatabase"),u._loadLocalDb(n,r,e,t)},_loadLocalDb:function(e,t,n,r){var o;return o=function(e){var o;if(u._database=void 0,e.open||e.load||e.migrate){o=e.open?"open":void 0,o=e.load?"load":o,o=e.migrate?"migrate":o;var a=new i(!0);a.warn("unable to "+o+" database, continue with no database")}else r(e);return t(),n()},u._database?u._database.load({lifeUid:u._lifeUid},e,t,n,o):(t(),n())},_fetchData:function(e,t){var n=new r({database:u._database,lifeUid:u._lifeUid,oauthToken:u._oauthToken,apiUrl:u._apiUrl});n.start(e,t,u._onMomentSyncComplete,u._onMomentSyncError)},_onMomentSyncComplete:function(e){u._momentData=e.moments,delete e.momentsHex,e.performance||(e.performance=[]),e.performance=e.performance.concat(u._performance),u._onCompleteCb(e)},_onMomentSyncError:function(e){u._onErrorCb(e)},saveMoments:function(e,t){u._database&&u._database.saveMoments(e,t)}};return u}),define("common/moment_loader/hex/moment_hex_parser",["common/moment_loader/hex/moment_hex"],function(e){var t=function(e,t){function r(){this.constructor=e}for(var o in t)n.call(t,o)&&(e[o]=t[o]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},n={}.hasOwnProperty;return MomentHexParser=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.parse=function(e,t){var n,r,o,i,a;for(r=0,n=0,o=e.length,a=[];r<o;)i=this._parseMoment(e.slice(r,r+this._momentLength())),t&&(i.filename=t[n],n++),a.push(JSON.stringify(i)),r+=this._momentLength();return a},n.prototype._parseMoment=function(e){var t,n,r;return this._str=e,n=this._flags(),r={uid:this._uid(),moment_date:this._dateTime(),item_type:"moment",moment_type:this._type(),height:this._height(),width:this._width(),caption_text:null,effects_modified_date:this._modified(),enhanced:n.enhanced,hidden:n.hidden,rating:n.rating},(this.options.upload||this.options.story)&&(r.upload_date=this._uploadDate()),this.options.story&&(r.moment_added_date=this._addedDate(),r.story_moment_created_by=this._createdBy()),(this.options.signature||this.options.story)&&(r.signature=this._signature()),this.options.covers&&(t=this._coverFlags(),r.highlight=t.highlight,r.day_cover=t.dayCover,r.month_cover=t.monthCover),r},n.prototype._slicer=function(e){return this._str.slice(this.DATA_MAP[e].beg,this.DATA_MAP[e].end)},n.prototype._uid=function(){var e=this._slicer("uid");return e.replace(/^(0)*/,"")},n.prototype._type=function(){var e=this._slicer("momentType");switch(e){case"0":return"image";case"1":return"video";case"2":return"text";case"3":return"milestone"}},n.prototype._dateTime=function(){var e,t,n;return t=this._slicer("date"),e=this._slicer("dateNeg"),n=parseInt(this._hexToDec(t)),n="0"===e?-n:n},n.prototype._uploadDate=function(){var e,t,n;return t=this._slicer("uploadDate"),e=this._slicer("dateNeg"),n=parseInt(this._hexToDec(t)),n="0"===e?-n:n},n.prototype._flags=function(){var e,t;return t=this._slicer("flags"),e=this.pad(this._decToBin(this._hexToDec(t))),{enhanced:"1"===e.slice(3,4),hidden:"1"===e.slice(2,3),rating:parseInt(e.slice(0,2),2)}},n.prototype._coverFlags=function(){var e,t;return t=this._slicer("covers"),e=this.pad(this._decToBin(this._hexToDec(t))),{highlight:"1"===e.slice(3,4),dayCover:"1"===e.slice(2,3),monthCover:"1"===e.slice(1,2)}},n.prototype._width=function(){return this._hexToDec(this._slicer("width"))},n.prototype._height=function(){return this._hexToDec(this._slicer("height"))},n.prototype._modified=function(){return this._hexToDec(this._slicer("modified"))},n.prototype._hexToDec=function(e){return parseInt(e,16)},n.prototype._decToBin=function(e){return e.toString(2)},n.prototype._addedDate=function(){return parseInt(this._hexToDec(this._slicer("createdDate")))},n.prototype._createdBy=function(){return this._slicer("personUid")},n.prototype._signature=function(){return this._slicer("signature")},n.prototype._momentLength=function(){return this.MOMENT_LENGTH},n}(e),MomentHexParser}),define("server/communicator",["server/moment_loader_server","server/worker_factory","common/moment_loader/hex/moment_hex_parser","utils/string_utils"],function(e,t,n,r){function o(e,t){window.addEventListener("message",this.receiveMessages.bind(this),!1),"//pmc.local.thislife.com"==e?this.targetOrigin=e:t?this.targetOrigin="//"+e+"."+t+".com":this.targetOrigin="//"+e+".shutterfly.com",this.targetOrigin=r.getProtocol()+this.targetOrigin,window.parent.postMessage("ready",this.targetOrigin)}return o.prototype.receiveMessages=function(r){var o=null,i=this,a=function(e){window.parent.postMessage({conversationId:o,result:e},i.targetOrigin)},s=function(e){window.parent.postMessage({conversationId:o,error:e},i.targetOrigin)};if(r.data&&r.data.oauthToken&&r.data.lifeUid&&r.data.env&&r.data.conversationId&&"load"==r.data.command)o=r.data.conversationId,e.loadData({oauthToken:r.data.oauthToken,env:r.data.env,lifeUid:r.data.lifeUid},a,s);else if("clear"==r.data.command&&r.data.conversationId)o=r.data.conversationId,e.clear(a);else if("parseStoryMoments"==r.data.command&&r.data.momentsStr&&r.data.conversationId){o=r.data.conversationId;r.data.filenames?r.data.filenames:null;t.createStoryWorker(r.data.momentsStr,r.data.filenames,a)}else if("parseMomentsHex"==r.data.command&&r.data.hex&&r.data.conversationId){o=r.data.conversationId;var u=new n,c=u.parse(r.data.hex);a(c)}else"refresh"==r.data.command&&r.data.conversationId?(o=r.data.conversationId,e.refresh(a,s)):"filter"==r.data.command&&r.data.conversationId&&r.data.attribute&&r.data.values?(o=r.data.conversationId,e.filter({attribute:r.data.attribute,isRange:r.data.isRange,values:r.data.values},a,s)):(o=r.data&&r.data.conversationId?r.data.conversationId:null,s("Invalid command"))},o}),require(["server/communicator"]);