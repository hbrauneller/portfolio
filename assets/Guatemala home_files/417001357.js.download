var HttpRequest=function(){var t=this;t.status=0;t.responseText=null};HttpRequest.prototype={_1:function(createType){if(!createType)createType=HttpRequest._0;var r=null;try{switch(createType){case 0:if(window.XMLHttpRequest){r=this._1(4);if(r!=null){HttpRequest._0=4}}else if(window.ActiveXObject){for(var i=1;i<4;i++){r=this._1(i);if(r!=null){HttpRequest._0=i;break}}}break;case 1:r=new ActiveXObject("MSXML2.XMLHTTP.4.0");break;case 2:r=new ActiveXObject("MSXML2.XMLHTTP");break;case 3:r=new ActiveXObject("Microsoft.XMLHTTP");break;case 4:r=new XMLHttpRequest();break;default:break}}catch(e){HttpRequest._0=0}return r},abort:function(){this.request.abort()},_5:function(url){var t=this;var r=t._1();if(r){t.request=r;try{r.onreadystatechange=function(){if(r.readyState==4){t._14()}};r.open("GET",url,true);r.send(null)}catch(ex){}}},_13:function(r){try{return r.status}catch(ex){return 200}},beginSend:function(url,oncomplete,asyncState){this.oncomplete=oncomplete;this.asyncState=asyncState;this._5(url)},_14:function(){var t=this;if(t.request){t.status=t._13(t.request);t.responseText=t.request.responseText}if(t.oncomplete){t.oncomplete(t)}},getCommandResponse:function(){return HttpRequest2._9(this.responseText)}};HttpRequest._0=0;Object.extend=function(value,props){if(props){for(var prop in props){value[prop]=props[prop]}}return value};var HttpRequest2=function(method,url,user,password){this.method=method;this.url=url;this.user=user;this.password=password;this.headers=null;this.status=0;this.responseText=null};Object.extend(HttpRequest2.prototype,{_1:function(createType){if(!createType)createType=HttpRequest2._0;var r=null;try{switch(createType){case 0:if(window.XMLHttpRequest){r=this._1(4);if(r!=null){HttpRequest2._0=4}}else if(window.ActiveXObject){for(var i=1;i<4;i++){r=this._1(i);if(r!=null){HttpRequest2._0=i;break}}}break;case 1:r=new ActiveXObject("MSXML2.XMLHTTP.4.0");break;case 2:r=new ActiveXObject("MSXML2.XMLHTTP");break;case 3:r=new ActiveXObject("Microsoft.XMLHTTP");break;case 4:r=new XMLHttpRequest();break;default:break}}catch(e){HttpRequest2._0=0}return r},setIfModifiedSince:function(value){this.setRequestHeader("If-Modified-Since",value)},setIfNoneMatch:function(value){this.setRequestHeader("If-None-Match",value)},setRequestHeader:function(name,value){var header=[name,value];if(this.headers){this.headers.push(header)}else{this.headers=[header]}},abort:function(){this.request.abort()},_5:function(message,async){var wp=window.parent;this.message=message;this.async=async;var r=this._1();if(r){this.request=r;if(async){var t=this;r.onreadystatechange=function(){if(r.readyState==4){t._10()}}}try{r.open(this.method,this.url,this.async,this.user,this.password);var body;var contentType=null;if(message){if(typeof message=="string"){body=message}else{contentType="application/x-www-form-urlencoded";body="";for(var prop in message){var propValue=message[prop];if(propValue||propValue==0){if(body.length>0){body+="&"}body+=prop+"="+encodeURIComponent(propValue)}}}}else{body=null}var h=this.headers;if(h){for(var i=0;i<h.length;i++){var header=h[i];if(header[0]=="Content-Type"){contentType=header[1]}else{r.setRequestHeader(header[0],header[1])}}}if(contentType)r.setRequestHeader("Content-Type",contentType);r.send(body);if(!async){this._10()}}catch(ex){wp.Shr.Trace.error("Error during HttpRequest.",ex)}}else{this._12=true;wp.Shr.Trace.error("Unable to create XMLHttpRequest")}},_10:function(){var r=this.request;var s=r.status;this.status=s;if(s==200){this.responseText=r.responseText}else if(s==304){}else if(s==302){var url=r.getResponseHeader("Location");if(url){this.url=url;this._5(this.message,this.async);return}}else{this.responseText=r.responseText}if(this.async)this.endSend();var pw=window.parent,cmdResponse=this.getCommandResponse(),logData={command:this.url,status:this.status};if(cmdResponse.error){Object.extend(logData,{error:cmdResponse.error.message||cmdResponse.error.clientMessage||"",errorCode:cmdResponse.error.code||""})}if(pw.Shr&&pw.Shr.Splunk)pw.Shr.Splunk.log(logData)},send:function(message){this._5(message,false)},beginSend:function(message,oncomplete,asyncState){this.oncomplete=oncomplete;this.asyncState=asyncState;this._5(message,true)},endSend:function(){if(this.request){this.status=this.request.status;this.responseText=this.request.responseText}if(this.oncomplete){this.oncomplete(this)}},getResponseHeader:function(name){return this.request.getResponseHeader(name)},getCommandResponse:function(){if(this._12){return{error:{code:1,message:"Unable to communicate with the server.\r\nThis may be due to your Web Browser security settings."}}}else{try{return HttpRequest2._9(this.responseText)}catch(ex){return{error:{code:1,message:"Error receiving information from the server."}}}}}});Object.extend(HttpRequest2,{_0:0,getResponse:function(url,modTime){var r=new HttpRequest2("get",url);r.send();if(modTime){var dateHeader=r.getResponseHeader("Date");if(!dateHeader){dateHeader=r.getResponseHeader("Last-Modified");if(!dateHeader){}}var time=Date.parse(dateHeader);var secs=time/1000;if(secs<modTime){r.setIfNoneMatch("x");r.send()}}return r},_9:function(r){try{var response;if(r){var wp=window.parent;if(r.charAt(0)=="{"){if(r.charAt(r.length-1)!="}"){r=r.replace(/\}HTTP\/1\.1 100 Continue\s+$/,"}")}response=wp.Object.fromString(r);if(response&&response.error){response.error.message=response.error.message||response.error.clientMessage}}else{response={error:{code:0,message:"Response did not contain JavaScript results.",details:r}}}}return response||{}}catch(ex){return{error:{code:1,message:"Error parsing server response.  "+ex.message,ex:ex,details:r}}}}});var Update=function(){var t={_4:null,_6:function(){try{var qs=window.location.search.replace(/^\?/,"").split("&"),parm,parms={},parts,handler,pw=window.parent;for(var i=0;i<qs.length;i++){parm=qs[i].split("=");parms[parm[0]]=decodeURIComponent(parm[1])}if(parms.noDocumentDomain=="true"){try{parts=parms.origin.split("/");if(parts.length==3&&(parts[0]=="http:"||parts[0]=="https:")&&parts[1]==""){t._3=parts[0]+"//";parts=parts[2].split(":");if(!parts[0].match(/\.(shutterfly\.com|tinyprints\.com|weddingpaperdivas\.com)$/)){parts[0]+=".shutterfly.com"}t._3+=parts[0];if(parts.length==2&&parts[1].match(/^[0-9]*$/)){t._3+=":"+parts[1]}}else{throw"Invalid origin: "+parms.origin}if(window.addEventListener){window.addEventListener("message",t._7,false)}else{window.attachEvent("onmessage",t._7)}pw.postMessage("onUpdateFrameLoad",t._3);return}catch(ex){console&&console.log&&console.log("Exception initializing update frame: "+ex.message+"\n"+(ex.stack?ex.stack:""));throw ex}}else{}var fd=document.domain;var pd=null;var p1=fd.lastIndexOf(".");if(p1>=0){var p2=fd.lastIndexOf(".",p1-1);if(p2>=0){pd=fd.substring(p2+1,fd.length)}}if(pd)document.domain=pd;pw=window.parent;window.Trace=pw.Shr.Trace;pw.Shr.WindowEx.onUpdateFrameLoad(t);setTimeout(t._8,1000)}catch(ex){window.alert("updateFrame _6 threw: "+ex.message)}},stop:function(){try{if(t._4){t._4.abort();t._4=null}}catch(ex){}},createXhr:function(method,url){return new HttpRequest2(method,url)},_8:function(){var pw=window.parent,Shr=pw.Shr,S=Shr.S,U=Shr.U,AR=Shr.AR,P=Shr.P,Dialog=Shr.Dialog;t.stop();if(!pw||!pw.Shr||!pw.Shr.S){return}var msg={site:S.id,user:U.un,page:P.id,inDialog:Dialog.isOpen(),changeId:P.changeId,start:AR.start,t:AR.t,t2:AR.t2,h:AR.h,usejwt_token:true};if(U.donotOwnSession)msg.donotOwnSession=U.donotOwnSession;if(P.previewAs)msg.previewAs=P.previewAs;var q=Shr.Html.formatQuery(msg);var r=t._4=new HttpRequest();if(Shr.PL.noRefreshCommand||Shr.B.isMonitor||(Shr.Settings&&Shr.Settings.noRefreshCommand))return;r.beginSend("async/refresh"+q,t._11)},_11:function(xr){var r=xr.getCommandResponse();var pw=window.parent;pw.Shr.WindowEx.onUpdate(r);var ttl=60;if(r&&r.result)ttl=r.result.ttl;t._4=null;setTimeout(t._8,ttl*1000)},_7:function(evt){var _2;if(evt.origin==t._3){if(evt.data=="stop"){t.stop()}else{_2=window.JSON.parse(evt.data);Object.extend(new HttpRequest2(),_2).beginSend(_2.args,function(xhr){_2.status=xhr.status;_2.responseText=xhr.responseText;window.parent.postMessage(window.JSON.stringify(_2),t._3)})}}else{}}};t._6();return t}();