(function(){
var version="423";

    // if is safari and we are coming from a back button reload the page
    if (navigator.userAgent.indexOf('Safari') != -1 && navigator.userAgent.indexOf('Chrome') == -1 && navigator.userAgent.indexOf('Android') == -1) {
        window.onpageshow = function(event) {
            if (typeof event.persisted !== "undefined" && event.persisted) {
                window.location.reload();
            }
        };
    }

    // check if to show loader
    if(document.getElementById("prod-widget-sfly").src.toLowerCase().indexOf("noloader=") != -1) {
        loadMainSDK();
        return;
    }

    if(window.location.href.indexOf("mgBreak") != -1) {
        debugger;
    }

    if(typeof window.MagicShop === "undefined") {
        window.MagicShop = {};
    }

    if(typeof MagicShop === "undefined") {
        MagicShop = {};
    }

    var abTestActive = window.location.href.indexOf("calendar") > -1;
    if (abTestActive /*&& $(".mboxDefaultContainer").length > 0*/) {
        console.log('[sdk.min.js] waiting mbox');
        var waitMboxTimeout = setTimeout(function () {
            console.log('[sdk.min.js] mbox not loaded after 2 sec (no abTest group set)');
            clearInterval(waitMboxInterval);
            startTheLoading();
        }, 2000);
        var waitMboxInterval = setInterval(function () {
            if (typeof MagicShop !== "undefined" && typeof MagicShop.abTestGroup !== "undefined") {
                console.log('[sdk.min.js] mbox loaded before 2 sec');
                clearTimeout(waitMboxTimeout);
                // if we are in GroupA, then MagicShop.abTestGroup is undefined
                // by testversion should include indication
                // two step check:
                //var cohort = MagicShop.abTestGroup;
                //
                //if (typeof cohort === "undefined" || !cohort) { // no test group set
                //    if (typeof testversion !== "undefined" && testversion.indexOf('No MS') !== -1) { // we are in group A
                //        cohort = 'control';
                //    } else { // not test group set
                //        cohort = 'badCohort';
                //    }
                //}
                //continueLoadMgAfterMbox({"cohort": cohort});
                clearInterval(waitMboxInterval);
                startTheLoading();
            }
        }, 100);
    } else {
        console.log('[sdk.min.js] not waiting mbox');
        startTheLoading();
    }

    function startTheLoading() {
        var mgDiv = document.getElementById("MagicShopFull");
        //we are in calendar page - append the MagicShopFull after calendar
        if (window.location.href.indexOf('calendars') > -1 || window.location.href.indexOf('special-offers') > -1) {

            mgDiv = document.createElement('div');
            mgDiv.setAttribute("id", "MagicShopFull");

            var targetDiv = window.location.href.indexOf('calendars') > -1 ? document.querySelector('.calendars') : document.querySelector('#specialOffersContainer');
            if (window.location.href.indexOf('calendars') > -1) {
                targetDiv.parentNode.insertBefore(mgDiv, targetDiv);
            }else if (window.location.href.indexOf('special-offers') > -1) {
                targetDiv.parentNode.insertBefore(mgDiv, targetDiv.nextSibling);
            }

            // if (MagicShop.abTestGroup !== 'GroupA') {
            //     mgDiv = document.createElement('div');
            //     mgDiv.setAttribute("id", "MagicShopFull");
            //     mgDiv.setAttribute("class", window.location.href.indexOf('calendars') > -1 ? "calendars-cat-page" : "specialoffers-cat-page");
            //     var calDiv = window.location.href.indexOf('calendars') > -1 ? document.querySelector('.calendars') : document.querySelector('#specialOffersContainer');
            //     if (calDiv) {
            //         if (window.location.href.indexOf('GroupB') > -1 || MagicShop.abTestGroup === 'GroupB') {
            //             calDiv.parentNode.insertBefore(mgDiv, calDiv.nextSibling);
            //         } else if (window.location.href.indexOf('GroupC') > -1 || MagicShop.abTestGroup === 'GroupC') {
            //             calDiv.parentNode.insertBefore(mgDiv, calDiv);
            //         } else if (window.location.href.indexOf('special-offers') > -1) {
            //             calDiv.parentNode.insertBefore(mgDiv, calDiv.nextSibling);
            //         }

            //     }
            // }
        } //else if (window.location.href.indexOf('GroupC') > -1 || MagicShop.abTestGroup === 'GroupC') {
          //  mgDiv.remove();
          //  var mysflyPromos = document.getElementById("mysfly-promos");
          //  var mgDivNew = document.createElement('div');
          //  mgDivNew.setAttribute("id", "MagicShopFull");
          //  mgDivNew.style.marginTop = "10px";
          //  mgDivNew.style.float = "left";
          //  mysflyPromos.parentNode.insertBefore(mgDivNew, mysflyPromos.nextSibling);
        //}

        if (typeof mgDiv !== "undefined" && mgDiv) {
            //NEW LOADER STARTS HERE

            mgDiv.style.border = "2px solid #f2f2f2";
            mgDiv.style['border-radius'] = "4px";
            mgDiv.style['margin-bottom'] = "10px";
            //if calendar page or specialoffer page or my account page with group A
            if (window.location.href.indexOf("calendar") > -1 || window.location.href.indexOf("special-offers") > -1
                || MagicShop.abTestGroup === 'GroupB' || window.location.href.indexOf('GroupB') > -1) {
                var mDiv = document.querySelector('#MagicShopFull');
                if (mDiv) {
                    mDiv.classList.add('one-line');
                }
                mgDiv.style.height = "350px";
            } else {
                mgDiv.style.height = "560px";
            }


            if (window.location.href.indexOf("calendar") > -1 || window.location.href.indexOf("special-offers") > -1
                || MagicShop.abTestGroup === 'GroupB' || window.location.href.indexOf('GroupB') > -1) {
                initiateLoader(mgDiv, 5);
            } else {
                initiateLoader(mgDiv, 10);
            }
        }


        // Display new container for HP 
        if(window.location.href.indexOf("ContainerSDK") > -1) 
        {    
            var mgDivNew = document.createElement('div');
            mgDivNew.setAttribute("id", "apc-homepage");
            mgDiv.parentNode.insertBefore(mgDivNew, mgDiv.nextSibling);

            var scriptParams = parse_query_vars(document.getElementById("prod-widget-sfly").src);

            function initContainers() {
                var e = new window.APCContainer({
                    containerElem: "#apc-homepage",
                    userId: Shr.U.id,
                    env: scriptParams.env,
                    token: Shr.U.oauthToken,
                    containerId: "apc-homepage",
                    input: {
                        photos: [],
                        products: [],
                        staticData: {
                            header: {
                                title: "MADE JUST FOR YOU",
                                promo1: "",
                                promo2: ""
                            }
                        }
                    },
                    config: {
                        monitorSource: "Home/MagicShop"
                    }
                });
                e.renderWidget()
            }
        
            var mgScript = document.createElement("script");
            mgScript.setAttribute("id", "mg-container-script");
            document.head.appendChild(mgScript);
            mgScript.onload = initContainers;
            mgScript.src = "prod" === serverEnv ? "https://container.photoccino.com/v1/release/HP/APCContainer.bundle.js" : "https://container-" + serverEnv + ".photoccino.com/v1/release/HP/APCContainer.bundle.js"
        }

        // Special use case for HP a/b test
        if ((window.location.href.indexOf("home") != -1) && (window.location.href.indexOf("home-decor") === -1)) {
            var res = LoadSDKIfContainerVisible();
            if (!res) {
                window.addEventListener('scroll', LoadSDKIfContainerVisible, true);
                window.addEventListener('resize', LoadSDKIfContainerVisible, true);
            }
        }
        else {
            loadMainSDK();
        }
    }

    function LoadSDKIfContainerVisible()
    {
        var mgDiv = $('#MagicShopFull');
        var mgTop = mgDiv.offset().top;
        var screenHeight = (window.pageYOffset + window.innerHeight);

        //console.log("mgTop", mgTop, "screenHeight", screenHeight);
        if(mgTop < screenHeight)
        {
            window.removeEventListener('scroll', LoadSDKIfContainerVisible, true);
            window.removeEventListener('resize', LoadSDKIfContainerVisible, true);
            loadMainSDK();
            return true;
        }
        else
        {
            return false;
        }
    }

    function GetServerUrl(useCDNin) {
        var mgServerUrl = "";
        if(useCDNin)
        {
            var CDNVer = "5.1";
            mgServerUrl = "https://d22bbwxztp2lry.cloudfront.net/v"+CDNVer+"/";
        }
        else
        {
            mgServerUrl = "https://magic.photoccino.com/";
            if((window.location.href.indexOf("beta.shutterfly.com") != -1) || (window.location.href.indexOf("172.24.66.1") != -1) || (window.location.href.indexOf("stage.shutterfly.com") != -1) || (window.location.href.indexOf("dev.shutterfly.com") != -1) || (window.location.href.indexOf("172.20.24.167") != -1) || (window.location.href.indexOf("amsingh.dev.shutterfly.com") != -1) || (window.location.href.indexOf("www.photoccino.com") != -1) )
            {
                mgServerUrl = "https://dev-magic.photoccino.com/";
            }
            if( window.location.href.indexOf("mgUI=stage") != -1)
            {
                mgServerUrl = "https://stage-magic.photoccino.com/";
            }
            if( window.location.href.indexOf("mgUI=beta") != -1)
            {
                mgServerUrl = "https://beta-magic.photoccino.com/";
            }
            mgServerUrl += "ServerMain/";
        }
        return mgServerUrl;
    }

    function initiateLoader(container, amount){
        //product backgrounds
        var backgrounds = [
                "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAA8KCw0LCQ8NDA0REA8RFiUYFhQUFi0gIhslNS84NzQvNDM7QlVIOz9QPzM0SmRLUFdaX2BfOUdob2dcblVdX1v/2wBDARARERYTFisYGCtbPTQ9W1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1v/wgARCAC1AL8DAREAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAECAwf/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAD0QAAgBACAAhAQAA2bIciAAAAAAAAAA2dDJyAAAAAAAAAANnQhxAAAAAAAAAANnQhxAAAAAAAAAANnQhxAAAAAAAAAANnQHAAAAAAAAAAA0dQcAAAAAAAAAADR1MnIAAAAAAAAAA0aOYAAAAAAAAAANEIAAAAAAAAAADRCAAAAAAAAAAA0QgAAAAAAAAAANEIAAAAAAAAAACnYHEgAAAAAAAAAKdgcSAAAAFABQUFBQaBghQUFBQAAAAAAAAAAAAAAAAAAAAZIAAAAAAAbAAABzMAAAAAAAHcAAAGTAAAAAAAKdAAAACHMAAAAAGjYAAAAMnIAAAAAGjqAAf/EACQQAAEEAQQDAQADAAAAAAAAAAEAAhJREwMyQGEQETAgUHHB/9oACAEBAAE/APz7CkLUhakLUgpBZGrIFkCmpmlkNBTcpuU3KblJy9m1pn2PB2leyvZ4mn4ftPG0/B2njafg8bT8XxmcjS3HkaW4+HODeNpbinOI4+luKfu47E/ceOxO3HjsT9x47PLtx4rPLt5/v5AGkGupQdSg5QcoFQNrHZWMLG1QCa0N8lntxKx2VjCxtUAoilEUgB/FudFT6U+lPpT6U+lPpT6U+lPpT6U+lPpT6U+kH+yB8X/dv+j4uaSsbrCxusLG6wsbrCxusLG6wsbrCxusLG6wsbrCxusLG6wsbrCxusINIIoH5OPppKm6gpuoKbqCm6gpuoKbqCm6gpuoKbqCm6gpuoKbqCY4uJB+b9h+rNx/X//EABQRAQAAAAAAAAAAAAAAAAAAAJD/2gAIAQIBAT8ACj//xAAUEQEAAAAAAAAAAAAAAAAAAACQ/9oACAEDAQE/AAo//9k=",
                "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAA8KCw0LCQ8NDA0REA8RFiUYFhQUFi0gIhslNS84NzQvNDM7QlVIOz9QPzM0SmRLUFdaX2BfOUdob2dcblVdX1v/2wBDARARERYTFisYGCtbPTQ9W1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1v/wgARCADMAJYDAREAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAIBAwf/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAD0QAwGAwAwGGAA06nEGAAAAAAAAsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA6AAAAAAAAAFgAAAAAAAAAkgAAAAAAGnQAg5gAAAAAAHcAkkAAAAAAGlgAw5AAAAAAo6AAEnIAAAAAFHUA//EACEQAAICAwEAAgMBAAAAAAAAAAABAhITQFFiIDIQETBx/9oACAEBAAE/APhZdLLpZGSJkRkRkLsvIvIvItIs+shLr/EpNn7eipvTWmtNaa01prTWmtNaa01prTWmtNaa00Y0Y0Y0Y0Y0Y0Y0Y0Y0Y0Y0Y0Y0Y0Y0Y0Y0Y0Y1qybjEvLiLy4i8uIvLiLy4i8uIvLiLy4i8uIvLiLy4i8uIvLiLy4iMm/hP6/3h9l/vwlGxT0U9FPRT0U9FPRT0U9FPRT0U9FPRT0U9Ch8ryLyLyLyLyLyLyLyLyLyLyLyISb+U/q/6w+3w//EABQRAQAAAAAAAAAAAAAAAAAAAID/2gAIAQIBAT8Ad3//xAAUEQEAAAAAAAAAAAAAAAAAAACA/9oACAEDAQE/AHd//9k=",
                "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAA0JCgsKCA0LCwsPDg0QFCEVFBISFCgdHhghMCoyMS8qLi00O0tANDhHOS0uQllCR05QVFVUMz9dY1xSYktTVFH/2wBDAQ4PDxQRFCcVFSdRNi42UVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVH/wgARCADWAK4DAREAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAEDAgf/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAD04AAAEIckIAADo6OgAAADM4IAAAAAU1OgAADAgAAAAABTcAAhTAgAAAAABTcEMzkhSAAAAAAApuQyIaAzIAAAAAACm5iQ2KDkxAAAAAABTYwNjoAGBAAAAAACnZybAAGBAAAAAAClOjQAAwIAAAAAAUp2dgAGBAAAAAAClOzsAAwIAAAAAAUp0aAAGBAAAAAACnZwbgAGBAAAAAACmxiaHYBmZgAAAAAApuZmZ2dkMyAAAAAAApuDgzICkAAAAAABTcAEBTAgAAAAABTcAAAxOQAAAAAU1OgAAAcGZAAAAU6NCgAAAAHJCEAOilKAAAAAAAAAAAAAADgoAAAAAAKUAAGJyAAAAAADQ0AABiAAAAAAAdnYAABycgAAAAA6OgAAAZHAAAAAANjoH//EACUQAQACAQMEAgMBAQAAAAAAAAEAAhITMDEDEBEgMkJAQVFhcf/aAAgBAQABPwDYUJnUmpM2Z3md5lb+szvM7zUYdSF6u1a/6ru1U4YXHYd49hOzvHdQjde5axw752UIqvllKrDp1mmRqj4d87XfL/hKGTADveuRvkXxVe1DwervE6jwSh5T2d4l+WdI5fZ3iW+TOnw+zvEt8mdPh9neJY8LOk8ns7xOocMo+EfZ3iJ5E7Ut9Xn0vb6m+dr1+x2r1E+UzI9Q/X4B3aHJGtjk7lbO+evggB2d42L1xfJxvUpibL0xjWxybILClpWobjUeSadZp/xmmzTt/SabDpkKVIAfn5gpMyZkzJmTMmZMyZkzJmTMmZMyZkrYt7vNv+7/AE/t72pZsoTC8wvMLzC8wvMLzC8wvMLzC8wvMLzC8wvKVTzsWvjNSak1JqTUmpNSak1JqTUmpKOVR2epzu9P4Hf/xAAUEQEAAAAAAAAAAAAAAAAAAACQ/9oACAECAQE/ABS//8QAFBEBAAAAAAAAAAAAAAAAAAAAkP/aAAgBAwEBPwAUv//Z",
                "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAA8KCw0LCQ8NDA0REA8RFiUYFhQUFi0gIhslNS84NzQvNDM7QlVIOz9QPzM0SmRLUFdaX2BfOUdob2dcblVdX1v/2wBDARARERYTFisYGCtbPTQ9W1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1v/wgARCADkAHwDAREAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAMBAgf/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAD0QHBwAAAAUOgACJgAAABpYAAgAAAADSwABAAAAAGlgACAAAAANLAAEAAAAAaWAAIAAAAA0sAAQAAAABpYAAiYAAAAaWAAImAAAAGlgACJgAAABpYAAiYAAAAaWAAImAAAAGlgACJgAAABpYAAiYAAAAaWAAImAAAAGlgACJgAAABpYAAiYAAAAaWAAImAAAAGlgACJgAAABpYAAiYAAAAaWAAJHIAAAB2UAAByYAAADsAAAAAAAAAEgAAAAAAAcgAAAAAAA7AAAAAAABQmcgAAAAAodAiYAAAAACp0f/EACIQAAEEAgIDAQEBAAAAAAAAAAEAAhJRIDIwYhATQAMRQf/aAAgBAQABPwDw5xCkbKkbKkbKkbK/rrKk5ScpGypGymOlkdjxfnt8DNh8DNh8DNh8DNh8DNh8DNhlfEzYZXxM2GV8TNhlfEzYZXxM2GV8TNhlfEzYZXxM2GV8TNhlfEzYZXxM2GV8TNhkdjxM2GTxxfm3/c4BQavWF6wvWF6wvWF6woN+WbqCm6gpuoKbqCm6gpuoKbqCm6gpuoKbqCm6gpuoKbqCm6gpuoKbqHww7KHZQ7KHZQ7KHZQ7KHZQ7KHZQ7KHZQ7KHZQ7KHbw5zgSApuU3KblNym5TcpuU3KblNym5TcmEkeXbHlZoPH/xAAUEQEAAAAAAAAAAAAAAAAAAACA/9oACAECAQE/AGh//8QAFBEBAAAAAAAAAAAAAAAAAAAAgP/aAAgBAwEBPwBof//Z",
                "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAA0JCgsKCA0LCwsPDg0QFCEVFBISFCgdHhghMCoyMS8qLi00O0tANDhHOS0uQllCR05QVFVUMz9dY1xSYktTVFH/2wBDAQ4PDxQRFCcVFSdRNi42UVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVH/wgARCADrAI8DAREAAhEBAxEB/8QAGQABAQEBAQEAAAAAAAAAAAAAAAIDAQQH/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAA+nAAAAk4dJOlgAAAAAEAgsFgAAAAAEAgsFgAAAk4AdOknDQAAAAGJIAAAB06DQoAGBwAAAAAGxQBJiAAAAADpuACDIAAAAAFGwAMiAAAAAAWagAwOAAAAAA1LAOGAAAAAABsUASYgAAAAA6bgAyIAAAAABRsADA4AAAAADQ0AOGAAAAAABqWASYgAAAAAGxQBmZgAAAAA6bgAxJAAAAAB03AAOEEg4cAAANCzoAAAIKOHCThwGpQAAAJOnQAAQWAAAAQWAAASUAAAAAAAAQWAAAAAAAAAAAAAAAAAAAAASZgAAAAAAGwJMQAAAAAAD0A4SAAAAAAAWAcMQAAAAAWaAA4YAAAAAAs1P/EACcQAAICAQMEAQQDAAAAAAAAAAECABETIDBRAxIyUiEQIkBxM0NQ/9oACAEBAAE/ANhmqfeBO8BbgDn5JqISDR3lFu0BPeRFFvUBPeeAIfMbxU3YMUFQSTZiCiDzCCDaxFINnZZqmQTIODMizIvM71jsCKBhIBWiPjbc2/62rMs8zubkxDaaSbJ3UFLoc0h/C6njuoLbS5vd6Q+TpY2Sd3pigdBNA7yCkGhzSboFnS53UFtpY253emPk6Ca3ukKGhzSbyClGjqHdAsgaXsk7q88fMGmhxD05jadrcbKCwYoobKC7bkyhxOwTGOTMZnYwlHiBSbAiCl2XNIYooax/IdoglxwNj+z9j8JjTj/MckCxMjTI0yNMjTI0yNMjTI0yNMjTI0yNMjTI0yN9ep4/hEAiYxMYmMTGJjExiYxMYmMTGJjExiYxMYmMaD4mW3sZbexlt7GW3sZbexlt7GW3sZbexlt7GW3sZbexlt7GdMkk2SdJ8Tu9LyP0/8QAFBEBAAAAAAAAAAAAAAAAAAAAkP/aAAgBAgEBPwAHP//EABQRAQAAAAAAAAAAAAAAAAAAAJD/2gAIAQMBAT8ABz//2Q==",
                "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAA0JCgsKCA0LCwsPDg0QFCEVFBISFCgdHhghMCoyMS8qLi00O0tANDhHOS0uQllCR05QVFVUMz9dY1xSYktTVFH/2wBDAQ4PDxQRFCcVFSdRNi42UVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVH/wgARCACbAKgDAREAAhEBAxEB/8QAGQABAQEBAQEAAAAAAAAAAAAAAAIDAQQH/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAA+nAA4QScAAAOgA6dOlgAkxAAAAAAAOm5BABIAAAAAAB0ok0BmcAAAAAAAKOGpQMiAAAAAAACjhqUCTEAAAAAAAo6UWDhgAAAAAAAUaGRsdBgcAAAAAABRsQZmpRgcAAAAAABZqCDM6SAAAAAAAalgEmRwAAAAAAHTY6AASZkgAAAAA1LAAABJBJwAAHTpoUAAAAADgOA6cKAAAAAAAAAAAAAAAMQAAAAAACywADzgAAAAAAGxQABAAAAAAAB0oAAGJwAAAAAGpQAABiSAAAAADYo/8QAJBAAAgECBQUBAQAAAAAAAAAAAQIAEhMQMkBRUgMRIDBxMVD/2gAIAQEAAT8A8N5XLjStpW0qbcyo7mVHcyo7mVHcypt5U25lby40rMuHaDqDxfKdAMC8uNA7SskEaAZh9jnuaYilpQsKaFMwjfp+xB2GL5tAmYQjsx+xMoxYAqdB08wjidM9wRtjvoOnmjCpSICQ0BB0XTzYMsRisVgcN/f0v0/MSm2AdtB0x++BUGFSPeATFFI8igMZCPai+koDKGhBHmATAjGKgHtpEoWULKFlCwKu38C40uNLjS40uNLjS40uNLjS40uNLjS40uNLjRCSCTpenl8rYlsS2JbEtiWxLYlsS2JbEtiWxLYlsS2IoCjzckEgEypuRlTcjKm5GVNyMqbkZU3IypuRlTcjKm5GVNyMqbkZU3IxMo9D5j7Vyj4MP//EABQRAQAAAAAAAAAAAAAAAAAAAID/2gAIAQIBAT8AUn//xAAUEQEAAAAAAAAAAAAAAAAAAACA/9oACAEDAQE/AFJ//9k=",
                "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAA0JCgsKCA0LCwsPDg0QFCEVFBISFCgdHhghMCoyMS8qLi00O0tANDhHOS0uQllCR05QVFVUMz9dY1xSYktTVFH/2wBDAQ4PDxQRFCcVFSdRNi42UVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVH/wgARCADvAHwDAREAAhEBAxEB/8QAGQABAQEBAQEAAAAAAAAAAAAAAAMCAQQH/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAA+kGzYAAAAAAJmC4AAAAAABE0ADoANHQAASMAAAAoUAABMmAAACxoAAGCQAAALGgAAZIgAAA9AAABkiDpwA6C4AAAIAAAGioAAAIAAAGioAAAIAAAGygAAAInAAAUNgAAAicAABU0AAACJwAAFTQAAAIAAAFDYAABkkAAAdLAAAGSQAAAKmgAAYJgAAAFTQABgmAAAACpoAGSQAAAABY6ADBg4AAAAVNAAAyTOAAAFTQAAAMmTAANlAAAAAAZOHTQAAAAAAAAAMgAAAAAAAiAAAAAAADoAAAAAAALmTgAAAAANHQRMgAAAAAsaP/EACUQAAICAAYCAwADAAAAAAAAAAECABIDIDAyUVIRExAxQEJhcf/aAAgBAQABPwB2NiPoCIxOu6/yEB8EH8DqA0GJPZPZPaJ7BPYs9iz2LFYNnfdo4X0c+Jo4Y8LnxNuimwZ8TbojO48odBVLfgw92jznwtx0X3H/AHPhD70W3tnw/o6Lb2z4e3Rbcc+Ht/Bh7dB9p0ENW/o6GJt0Uawz4miCREYNmxNNGsMrgldMEiKfKg5WQGFSulh7c9BCrDQQeF0SqtKGEFciLq0WesQIB+W68y68y68y68y68y68y68y68y68y68y68y68y68y68y68y68/hq3UyrdTKt1Mq3UyrdTKt1Mq3UyrdTKt1Mq3UyrdTKt1Mq3UyrdTKt1Mq3U/BcA+DLrLrLrLrLrLrLrLrLrLrLrLrFIYfL7jqps+P/8QAFBEBAAAAAAAAAAAAAAAAAAAAgP/aAAgBAgEBPwBwf//EABQRAQAAAAAAAAAAAAAAAAAAAID/2gAIAQMBAT8AcH//2Q==",
                "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAA8KCw0LCQ8NDA0REA8RFiUYFhQUFi0gIhslNS84NzQvNDM7QlVIOz9QPzM0SmRLUFdaX2BfOUdob2dcblVdX1v/2wBDARARERYTFisYGCtbPTQ9W1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1v/wgARCADpAHsDAREAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAMBAgf/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAD0QAAwkadHYAAAAAJnR0QKnQAAAABE06OAUOgAAAARMAOgVAAAABM4Bp0aadAAAAEjkA7OyZUAAAETAAChh2aAADgmAADTShoAAJHIAABY0AAAiYAAAWNAAAImAAAFjQAACJgAABY0AAAiYAAAWNAAAImAAAFjQAACJgAABY0AAAkcgAAFjQAACRyAAAWNAAAJHIAABY0AAAkcgAAFjQAACRyAAAWNAAAJHIAABY0AAAiYAAAWNBhoAOSYMANNKGgAAAAGGgAAAAAAAAAAAgAAAAAAAAAAAAAAACoAAAAAAAOiJgAAAAAKnQImAAAAAAqdH//EACMQAAICAgIDAAIDAAAAAAAAAAECADARMiJhEBIgIVEDMVD/2gAIAQEAAT8A+WOBMu05xHycWuf6ETUeGGGOIhyOxY+0R8DBhcQnMBbOREbNbA5J+E/D4mr1v5Eb8ODHGREOVqcg/DEFQRF1iH1YqaWfP1/HrHGCGg+3P2hwcxm9sAQfb7UKAKH2oWh9qFofagUPtQKH2oFD7UCh9qBQ+1AofagUPtQKH2oFD7UCh9qAfI+WUGFGnqfgKTFS3A/2fRf0JhZw6nDqcOpw6nDqcOpw6nDqcOpw6nDqcOpgT0X9Dw+9q6jy+9q6jx//xAAUEQEAAAAAAAAAAAAAAAAAAACA/9oACAECAQE/AHB//8QAFBEBAAAAAAAAAAAAAAAAAAAAgP/aAAgBAwEBPwBwf//Z",
                "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAA0JCgsKCA0LCwsPDg0QFCEVFBISFCgdHhghMCoyMS8qLi00O0tANDhHOS0uQllCR05QVFVUMz9dY1xSYktTVFH/2wBDAQ4PDxQRFCcVFSdRNi42UVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVFRUVH/wgARCADWAK4DAREAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAEDAgf/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAD04AAAEIckIAADo6OgAAADM4IAAAAAU1OgAADAgAAAAABTcAAhTAgAAAAABTcEMzkhSAAAAAAApuQyIaAzIAAAAAACm5iQ2KDkxAAAAAABTYwNjoAGBAAAAAACnZybAAGBAAAAAAClOjQAAwIAAAAAAUp2dgAGBAAAAAAClOzsAAwIAAAAAAUp0aAAGBAAAAAACnZwbgAGBAAAAAACmxiaHYBmZgAAAAAApuZmZ2dkMyAAAAAAApuDgzICkAAAAAABTcAEBTAgAAAAABTcAAAxOQAAAAAU1OgAAAcGZAAAAU6NCgAAAAHJCEAOilKAAAAAAAAAAAAAADgoAAAAAAKUAAGJyAAAAAADQ0AABiAAAAAAAdnYAABycgAAAAA6OgAAAZHAAAAAANjoH//EACUQAQACAQMEAgMBAQAAAAAAAAEAAhITMDEDEBEgMkJAQVFhcf/aAAgBAQABPwDYUJnUmpM2Z3md5lb+szvM7zUYdSF6u1a/6ru1U4YXHYd49hOzvHdQjde5axw752UIqvllKrDp1mmRqj4d87XfL/hKGTADveuRvkXxVe1DwervE6jwSh5T2d4l+WdI5fZ3iW+TOnw+zvEt8mdPh9neJY8LOk8ns7xOocMo+EfZ3iJ5E7Ut9Xn0vb6m+dr1+x2r1E+UzI9Q/X4B3aHJGtjk7lbO+evggB2d42L1xfJxvUpibL0xjWxybILClpWobjUeSadZp/xmmzTt/SabDpkKVIAfn5gpMyZkzJmTMmZMyZkzJmTMmZMyZkrYt7vNv+7/AE/t72pZsoTC8wvMLzC8wvMLzC8wvMLzC8wvMLzC8wvKVTzsWvjNSak1JqTUmpNSak1JqTUmpKOVR2epzu9P4Hf/xAAUEQEAAAAAAAAAAAAAAAAAAACQ/9oACAECAQE/ABS//8QAFBEBAAAAAAAAAAAAAAAAAAAAkP/aAAgBAwEBPwAUv//Z",
                "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAA8KCw0LCQ8NDA0REA8RFiUYFhQUFi0gIhslNS84NzQvNDM7QlVIOz9QPzM0SmRLUFdaX2BfOUdob2dcblVdX1v/2wBDARARERYTFisYGCtbPTQ9W1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1tbW1v/wgARCAC1AL8DAREAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAECAwf/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAD0QAAgBACAAhAQAA2bIciAAAAAAAAAA2dDJyAAAAAAAAAANnQhxAAAAAAAAAANnQhxAAAAAAAAAANnQhxAAAAAAAAAANnQHAAAAAAAAAAA0dQcAAAAAAAAAADR1MnIAAAAAAAAAA0aOYAAAAAAAAAANEIAAAAAAAAAADRCAAAAAAAAAAA0QgAAAAAAAAAANEIAAAAAAAAAACnYHEgAAAAAAAAAKdgcSAAAAFABQUFBQaBghQUFBQAAAAAAAAAAAAAAAAAAAAZIAAAAAAAbAAABzMAAAAAAAHcAAAGTAAAAAAAKdAAAACHMAAAAAGjYAAAAMnIAAAAAGjqAAf/EACQQAAEEAQQDAQADAAAAAAAAAAEAAhJREwMyQGEQETAgUHHB/9oACAEBAAE/APz7CkLUhakLUgpBZGrIFkCmpmlkNBTcpuU3KblJy9m1pn2PB2leyvZ4mn4ftPG0/B2njafg8bT8XxmcjS3HkaW4+HODeNpbinOI4+luKfu47E/ceOxO3HjsT9x47PLtx4rPLt5/v5AGkGupQdSg5QcoFQNrHZWMLG1QCa0N8lntxKx2VjCxtUAoilEUgB/FudFT6U+lPpT6U+lPpT6U+lPpT6U+lPpT6U+kH+yB8X/dv+j4uaSsbrCxusLG6wsbrCxusLG6wsbrCxusLG6wsbrCxusLG6wsbrCxusINIIoH5OPppKm6gpuoKbqCm6gpuoKbqCm6gpuoKbqCm6gpuoKbqCY4uJB+b9h+rNx/X//EABQRAQAAAAAAAAAAAAAAAAAAAJD/2gAIAQIBAT8ACj//xAAUEQEAAAAAAAAAAAAAAAAAAACQ/9oACAEDAQE/AAo//9k="
            ]
        ;

        //create the new loader
        var loader = document.createElement("div");
        loader.setAttribute("id", "mainLoader");

        //add "made just for you"
        var madeJustForYouContainer = document.createElement("div");
        madeJustForYouContainer.setAttribute("id", "madeJustForYou");

        var madeJustForYouImage = document.createElement("img");
        madeJustForYouImage.setAttribute("src",
            "data:image/png;base64,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");
        madeJustForYouImage.setAttribute("style", "width:300px;padding-left:1.5%;padding-top:2%")
        madeJustForYouContainer.appendChild(madeJustForYouImage);

        var madeJustForYouTitle = document.createElement("span");
        madeJustForYouTitle.innerText = "Preparing your personalized product ideas...";
        madeJustForYouTitle.setAttribute("style",
            "display:block;padding-left:1.5%;margin-top:-6px;font-family:\"Avenir LT W01 45 Book\",Avenir,Verdana,Arial,sans-serif;line-height:18px;font-size:14px;color:#747577");
        madeJustForYouContainer.appendChild(madeJustForYouTitle);

        container.appendChild(madeJustForYouContainer);

        //create product divs (10)
        var columns = [];


        for (var i = 0; i < amount; i++) {
            var product = document.createElement("div");
            product.setAttribute("class", "product loading");
            product.style['background-image'] = "url(" + backgrounds[i] + ")";
            loader.appendChild(product);
            if(i < 5){
                columns.push("auto");
            }
        }

        //append styles
        var style = document.createElement("style");
        style.setAttribute("type", "text/css");


        style.innerHTML =
            "#mainLoader{display:grid;grid-template-columns:" + columns.join(" ") + ";padding-left:1.5%;padding-top:1.2%}.product{background-color:#fff;width:125px;height:188px;background-repeat:no-repeat;background-position:center;background-size:100px 137px;padding:23px 25px 11px 31px;position:relative;overflow:hidden;border-radius:4px;border:1px solid #dcdee1;margin-bottom:10px}.product.loading:after{content:\"\";position:absolute;width:150%;height:150%;opacity:0;transform:rotate(30deg);background:rgba(255,255,255,.3);background:linear-gradient(to right,rgba(255,255,255,0) 0,rgba(255,255,255,.5) 20%,rgba(255,255,255,.9) 30%,rgba(255,255,255,.5) 40%,rgba(255,255,255,0) 100%);-webkit-animation-duration:2s;-webkit-animation-fill-mode:forwards;-webkit-animation-iteration-count:infinite;-webkit-animation-name:placeholderShimmer;-webkit-animation-timing-function:linear}@-webkit-keyframes placeholderShimmer{0%{top:-200%;left:-200%;opacity:0}100%{opacity:1;top:30%;left:30%;//transition-property:left,top,opacity;//transition-duration:.7s,.7s,.15s;//transition-timing-function:ease}}";

        loader.appendChild(style);

        //add new loader to parent div
        container.appendChild(loader);

        //titles span
        var titles = ['Preparing your personalized product ideas...',
            'Selecting personalized products...',
            'Picking your best photos...',
            'Assembling products and matching photos...',
            'Finishing up...'];

        var titleIndex = 0;
        var titlesInterval = setInterval(function () {
            madeJustForYouTitle.innerHTML = titles[titleIndex];
            if(titleIndex === titles.length-1) clearInterval(titlesInterval);
            titleIndex++
        }, 1500);

        //check if magic shop not loaded after 20 secs - if not > remove container
        setTimeout(function(){
            if(document.getElementsByClassName("sfly_wgt_product").length === 0){
                $("#MagicShopFull").slideToggle("slow",function(){
                    $("#MagicShopFull").remove();
                })
            }
        },20000);


        //NEW LOADER ENDS HERE
    }

    function parse_query_vars(text)
    { // Extract name=value pairs from URL query string.
        text = text.toLowerCase();
        // Empty object to store name, value pairs.
        var qvars = {},
            // Capture non-empty query string in $1.
            re_q = /\?([^#]+)/, // From '?' up to '#' or EOS.
            // Capture variable name in $1 and value in $2.
            re_nv = /([^=]+)=([^&]*)(?:&(amp;)?|$)/gi,
            // Match array for query string con va=val pairs.
            m =  text.match(re_q),
            // Query string plucked from URL
            q = '';
        // If there is a query string, copy to q var.
        if (m) q = m[1];
        while (m = re_nv.exec(q)) {
            qvars[m[1]] = m[2];
        }

        return qvars; // Return results in object
    }

    function loadMainSDK()
    {
        // Prevent for loading twice
        if(typeof window.mgShop !== "undefined")
        {
            return;
        }

        var endPoint = 'https://d22bbwxztp2lry.cloudfront.net';
        var env = 'prod';
        var scriptParams = parse_query_vars(document.getElementById("prod-widget-sfly").src);
        if (window.location.href.indexOf('calendars') !== -1) {
            if (!scriptParams.partneruserid) {
                $("#MagicShopFull").slideToggle("slow",function(){
                    $("#MagicShopFull").remove();
                })
            }
        }
        if(typeof scriptParams.env !== void 0){
            env =  scriptParams.env;
        } else {
            if (window.location.href.indexOf("dev.shutterfly.com") != -1) {
                env = 'dev';
            }
            else if (window.location.href.indexOf("beta.shutterfly.com") != -1) {
                env = 'beta';
            }
            else if (window.location.href.indexOf("stage.shutterfly.com") != -1) {
                env = 'stage';
            }
        }
        switch(env) {
            case 'dev':
                endPoint = 'https://s3.amazonaws.com/magicshopfiles';
                break;
            case 'beta':
                endPoint = 'https://s3.amazonaws.com/magicshopfiles';
                break;
        }
        var sc = document.createElement("script");
        sc.src = endPoint+'/productswidget/Shutterfly/sidewidget/v1.1/'+env+'/v'+version+'/sdkm.min.js';
        document.body.appendChild(sc);
        window.mgShop = { timeSdk : Date.now() };
    }
})()
