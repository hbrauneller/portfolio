/**
 * @license almond 0.3.3 Copyright jQuery Foundation and other contributors.
 * Released under MIT license, http://github.com/requirejs/almond/LICENSE
 */

//     Underscore.js 1.8.3
//     http://underscorejs.org
//     (c) 2009-2015 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Underscore may be freely distributed under the MIT license.

!function(){var n,t,e;!function(r){function o(n,t){return _.call(n,t)}function i(n,t){var e,r,o,i,a,s,u,c,l,f,p,d,h=t&&t.split("/"),m=w.map,v=m&&m["*"]||{};if(n){for(n=n.split("/"),a=n.length-1,w.nodeIdCompat&&O.test(n[a])&&(n[a]=n[a].replace(O,"")),"."===n[0].charAt(0)&&h&&(d=h.slice(0,h.length-1),n=d.concat(n)),l=0;l<n.length;l++)if(p=n[l],"."===p)n.splice(l,1),l-=1;else if(".."===p){if(0===l||1===l&&".."===n[2]||".."===n[l-1])continue;l>0&&(n.splice(l-1,2),l-=2)}n=n.join("/")}if((h||v)&&m){for(e=n.split("/"),l=e.length;l>0;l-=1){if(r=e.slice(0,l).join("/"),h)for(f=h.length;f>0;f-=1)if(o=m[h.slice(0,f).join("/")],o&&(o=o[r])){i=o,s=l;break}if(i)break;!u&&v&&v[r]&&(u=v[r],c=l)}!i&&u&&(i=u,s=c),i&&(e.splice(0,s,i),n=e.join("/"))}return n}function a(n,t){return function(){var e=T.call(arguments,0);return"string"!=typeof e[0]&&1===e.length&&e.push(null),h.apply(r,e.concat([n,t]))}}function s(n){return function(t){return i(t,n)}}function u(n){return function(t){g[n]=t}}function c(n){if(o(y,n)){var t=y[n];delete y[n],b[n]=!0,d.apply(r,t)}if(!o(g,n)&&!o(b,n))throw new Error("No "+n);return g[n]}function l(n){var t,e=n?n.indexOf("!"):-1;return e>-1&&(t=n.substring(0,e),n=n.substring(e+1,n.length)),[t,n]}function f(n){return n?l(n):[]}function p(n){return function(){return w&&w.config&&w.config[n]||{}}}var d,h,m,v,g={},y={},w={},b={},_=Object.prototype.hasOwnProperty,T=[].slice,O=/\.js$/;m=function(n,t){var e,r=l(n),o=r[0],a=t[1];return n=r[1],o&&(o=i(o,a),e=c(o)),o?n=e&&e.normalize?e.normalize(n,s(a)):i(n,a):(n=i(n,a),r=l(n),o=r[0],n=r[1],o&&(e=c(o))),{f:o?o+"!"+n:n,n:n,pr:o,p:e}},v={require:function(n){return a(n)},exports:function(n){var t=g[n];return"undefined"!=typeof t?t:g[n]={}},module:function(n){return{id:n,uri:"",exports:g[n],config:p(n)}}},d=function(n,t,e,i){var s,l,p,d,h,w,_,T=[],O=typeof e;if(i=i||n,w=f(i),"undefined"===O||"function"===O){for(t=!t.length&&e.length?["require","exports","module"]:t,h=0;h<t.length;h+=1)if(d=m(t[h],w),l=d.f,"require"===l)T[h]=v.require(n);else if("exports"===l)T[h]=v.exports(n),_=!0;else if("module"===l)s=T[h]=v.module(n);else if(o(g,l)||o(y,l)||o(b,l))T[h]=c(l);else{if(!d.p)throw new Error(n+" missing "+l);d.p.load(d.n,a(i,!0),u(l),{}),T[h]=g[l]}p=e?e.apply(g[n],T):void 0,n&&(s&&s.exports!==r&&s.exports!==g[n]?g[n]=s.exports:p===r&&_||(g[n]=p))}else n&&(g[n]=e)},n=t=h=function(n,t,e,o,i){if("string"==typeof n)return v[n]?v[n](t):c(m(n,f(t)).f);if(!n.splice){if(w=n,w.deps&&h(w.deps,w.callback),!t)return;t.splice?(n=t,t=e,e=null):n=r}return t=t||function(){},"function"==typeof e&&(e=o,o=i),o?d(r,n,t,e):setTimeout(function(){d(r,n,t,e)},4),h},h.config=function(n){return h(n)},n._defined=g,e=function(n,t,e){if("string"!=typeof n)throw new Error("See almond README: incorrect module build, no module name");t.splice||(e=t,t=[]),o(g,n)||o(y,n)||(y[n]=[n,t,e])},e.amd={jQuery:!0}}(),e("../bower_components/almond/almond",function(){}),function(){function n(n,t,e,r){this.name=n,this.entryType=t,this.startTime=e,this.duration=r}function t(n){for(var t,e={},r=[],o=0,i=s.length;o<i;o++)t=s[o],t.entryType!==n&&(e[t.name]=t,r.push(t));a=e,s=r}function e(n,t){window.performance[n]||("getEntries"===n&&(o=function(){return s}),window.performance[n]=t)}function r(n,e){if(void 0===e)t(n);else{for(var r,o=[],i=0;i<s.length;i++)r=s[i],r.name===e&&r.entryType===n||o.push(r);s=o,r=a[e],r&&r.entryType===n&&(a[e]=void 0)}}window.performance||(window.performance={});var o,i=(new Date).getTime(),a={},s=[],u={navigationStart:!0,unloadEventStart:!0,unloadEventEnd:!0,redirectStart:!0,redirectEnd:!0,fetchStart:!0,domainLookupStart:!0,domainLookupEnd:!0,connectStart:!0,connectEnd:!0,secureConnectionStart:!0,requestStart:!0,responseStart:!0,responseEnd:!0,domLoading:!0,domInteractive:!0,domContentLoadedEventStart:!0,domContentLoadedEventEnd:!0,domComplete:!0,loadEventStart:!0,loadEventEnd:!0};e("now",function(){return(new Date).getTime()-i}),e("mark",function(t){if(u[t])throw Error("'"+t+"' is part of the PerformanceTiming interface, and cannot be used as a mark name.");var e=new n(t,"mark",window.performance.now(),0);s.push(e),a[t]=e}),e("clearMarks",function(n){r("mark",n)}),e("measure",function(t,e,r){var o=void 0===e,i=void 0===r,u=window.performance.now(),c=0,l=0;if(o)c=0;else{if(!a[e])throw Error("The mark '"+e+"' does not exist.");c=a[e].startTime}if(i)l=u;else{if(!a[r])throw Error("The mark '"+r+"' does not exist.");l=a[r].startTime}var f=new n(t,"measure",u,l-c);s.push(f),a[t]=f}),e("clearMeasures",function(n){r("measure",n)}),e("getEntries",function(n){var t=o();if(void 0===n)return t;var e;return n.entryType?e=n.name?function(t){return t.entryType===n.entryType&&t.name===n.name}:function(t){return t.entryType===n.entryType}:n.name&&(e=function(t){return t.name===n.name}),t.filter(e)}),e("getEntriesByName",function(n,t){var e={name:n};return t&&(e.entryType=t),this.getEntries(e)}),e("getEntriesByType",function(n){return this.getEntries({entryType:n})})}(),e("polyfills/performance",function(){}),e("utils/string_utils",[],{replace:function(n,t){for(var e=0;e<t.length;e++)reg=new RegExp("\\{"+e+"\\}","gm"),n=n.replace(reg,t[e]);return n},getProtocol:function(){return window.location.protocol}}),function(){function n(n){function t(t,e,r,o,i,a){for(;i>=0&&i<a;i+=n){var s=o?o[i]:i;r=e(r,t[s],s,t)}return r}return function(e,r,o,i){r=b(r,i,4);var a=!E(e)&&w.keys(e),s=(a||e).length,u=n>0?0:s-1;return arguments.length<3&&(o=e[a?a[u]:u],u+=n),t(e,r,o,a,u,s)}}function t(n){return function(t,e,r){e=_(e,r);for(var o=M(t),i=n>0?0:o-1;i>=0&&i<o;i+=n)if(e(t[i],i,t))return i;return-1}}function r(n,t,e){return function(r,o,i){var a=0,s=M(r);if("number"==typeof i)n>0?a=i>=0?i:Math.max(i+s,a):s=i>=0?Math.min(i+1,s):i+s+1;else if(e&&i&&s)return i=e(r,o),r[i]===o?i:-1;if(o!==o)return i=t(f.call(r,a,s),w.isNaN),i>=0?i+a:-1;for(i=n>0?a:s-1;i>=0&&i<s;i+=n)if(r[i]===o)return i;return-1}}function o(n,t){var e=A.length,r=n.constructor,o=w.isFunction(r)&&r.prototype||u,i="constructor";for(w.has(n,i)&&!w.contains(t,i)&&t.push(i);e--;)i=A[e],i in n&&n[i]!==o[i]&&!w.contains(t,i)&&t.push(i)}var i=this,a=i._,s=Array.prototype,u=Object.prototype,c=Function.prototype,l=s.push,f=s.slice,p=u.toString,d=u.hasOwnProperty,h=Array.isArray,m=Object.keys,v=c.bind,g=Object.create,y=function(){},w=function(n){return n instanceof w?n:this instanceof w?void(this._wrapped=n):new w(n)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=w),exports._=w):i._=w,w.VERSION="1.8.3";var b=function(n,t,e){if(void 0===t)return n;switch(null==e?3:e){case 1:return function(e){return n.call(t,e)};case 2:return function(e,r){return n.call(t,e,r)};case 3:return function(e,r,o){return n.call(t,e,r,o)};case 4:return function(e,r,o,i){return n.call(t,e,r,o,i)}}return function(){return n.apply(t,arguments)}},_=function(n,t,e){return null==n?w.identity:w.isFunction(n)?b(n,t,e):w.isObject(n)?w.matcher(n):w.property(n)};w.iteratee=function(n,t){return _(n,t,1/0)};var T=function(n,t){return function(e){var r=arguments.length;if(r<2||null==e)return e;for(var o=1;o<r;o++)for(var i=arguments[o],a=n(i),s=a.length,u=0;u<s;u++){var c=a[u];t&&void 0!==e[c]||(e[c]=i[c])}return e}},O=function(n){if(!w.isObject(n))return{};if(g)return g(n);y.prototype=n;var t=new y;return y.prototype=null,t},I=function(n){return function(t){return null==t?void 0:t[n]}},k=Math.pow(2,53)-1,M=I("length"),E=function(n){var t=M(n);return"number"==typeof t&&t>=0&&t<=k};w.each=w.forEach=function(n,t,e){t=b(t,e);var r,o;if(E(n))for(r=0,o=n.length;r<o;r++)t(n[r],r,n);else{var i=w.keys(n);for(r=0,o=i.length;r<o;r++)t(n[i[r]],i[r],n)}return n},w.map=w.collect=function(n,t,e){t=_(t,e);for(var r=!E(n)&&w.keys(n),o=(r||n).length,i=Array(o),a=0;a<o;a++){var s=r?r[a]:a;i[a]=t(n[s],s,n)}return i},w.reduce=w.foldl=w.inject=n(1),w.reduceRight=w.foldr=n(-1),w.find=w.detect=function(n,t,e){var r;if(r=E(n)?w.findIndex(n,t,e):w.findKey(n,t,e),void 0!==r&&r!==-1)return n[r]},w.filter=w.select=function(n,t,e){var r=[];return t=_(t,e),w.each(n,function(n,e,o){t(n,e,o)&&r.push(n)}),r},w.reject=function(n,t,e){return w.filter(n,w.negate(_(t)),e)},w.every=w.all=function(n,t,e){t=_(t,e);for(var r=!E(n)&&w.keys(n),o=(r||n).length,i=0;i<o;i++){var a=r?r[i]:i;if(!t(n[a],a,n))return!1}return!0},w.some=w.any=function(n,t,e){t=_(t,e);for(var r=!E(n)&&w.keys(n),o=(r||n).length,i=0;i<o;i++){var a=r?r[i]:i;if(t(n[a],a,n))return!0}return!1},w.contains=w.includes=w.include=function(n,t,e,r){return E(n)||(n=w.values(n)),("number"!=typeof e||r)&&(e=0),w.indexOf(n,t,e)>=0},w.invoke=function(n,t){var e=f.call(arguments,2),r=w.isFunction(t);return w.map(n,function(n){var o=r?t:n[t];return null==o?o:o.apply(n,e)})},w.pluck=function(n,t){return w.map(n,w.property(t))},w.where=function(n,t){return w.filter(n,w.matcher(t))},w.findWhere=function(n,t){return w.find(n,w.matcher(t))},w.max=function(n,t,e){var r,o,i=-(1/0),a=-(1/0);if(null==t&&null!=n){n=E(n)?n:w.values(n);for(var s=0,u=n.length;s<u;s++)r=n[s],r>i&&(i=r)}else t=_(t,e),w.each(n,function(n,e,r){o=t(n,e,r),(o>a||o===-(1/0)&&i===-(1/0))&&(i=n,a=o)});return i},w.min=function(n,t,e){var r,o,i=1/0,a=1/0;if(null==t&&null!=n){n=E(n)?n:w.values(n);for(var s=0,u=n.length;s<u;s++)r=n[s],r<i&&(i=r)}else t=_(t,e),w.each(n,function(n,e,r){o=t(n,e,r),(o<a||o===1/0&&i===1/0)&&(i=n,a=o)});return i},w.shuffle=function(n){for(var t,e=E(n)?n:w.values(n),r=e.length,o=Array(r),i=0;i<r;i++)t=w.random(0,i),t!==i&&(o[i]=o[t]),o[t]=e[i];return o},w.sample=function(n,t,e){return null==t||e?(E(n)||(n=w.values(n)),n[w.random(n.length-1)]):w.shuffle(n).slice(0,Math.max(0,t))},w.sortBy=function(n,t,e){return t=_(t,e),w.pluck(w.map(n,function(n,e,r){return{value:n,index:e,criteria:t(n,e,r)}}).sort(function(n,t){var e=n.criteria,r=t.criteria;if(e!==r){if(e>r||void 0===e)return 1;if(e<r||void 0===r)return-1}return n.index-t.index}),"value")};var S=function(n){return function(t,e,r){var o={};return e=_(e,r),w.each(t,function(r,i){var a=e(r,i,t);n(o,r,a)}),o}};w.groupBy=S(function(n,t,e){w.has(n,e)?n[e].push(t):n[e]=[t]}),w.indexBy=S(function(n,t,e){n[e]=t}),w.countBy=S(function(n,t,e){w.has(n,e)?n[e]++:n[e]=1}),w.toArray=function(n){return n?w.isArray(n)?f.call(n):E(n)?w.map(n,w.identity):w.values(n):[]},w.size=function(n){return null==n?0:E(n)?n.length:w.keys(n).length},w.partition=function(n,t,e){t=_(t,e);var r=[],o=[];return w.each(n,function(n,e,i){(t(n,e,i)?r:o).push(n)}),[r,o]},w.first=w.head=w.take=function(n,t,e){if(null!=n)return null==t||e?n[0]:w.initial(n,n.length-t)},w.initial=function(n,t,e){return f.call(n,0,Math.max(0,n.length-(null==t||e?1:t)))},w.last=function(n,t,e){if(null!=n)return null==t||e?n[n.length-1]:w.rest(n,Math.max(0,n.length-t))},w.rest=w.tail=w.drop=function(n,t,e){return f.call(n,null==t||e?1:t)},w.compact=function(n){return w.filter(n,w.identity)};var x=function(n,t,e,r){for(var o=[],i=0,a=r||0,s=M(n);a<s;a++){var u=n[a];if(E(u)&&(w.isArray(u)||w.isArguments(u))){t||(u=x(u,t,e));var c=0,l=u.length;for(o.length+=l;c<l;)o[i++]=u[c++]}else e||(o[i++]=u)}return o};w.flatten=function(n,t){return x(n,t,!1)},w.without=function(n){return w.difference(n,f.call(arguments,1))},w.uniq=w.unique=function(n,t,e,r){w.isBoolean(t)||(r=e,e=t,t=!1),null!=e&&(e=_(e,r));for(var o=[],i=[],a=0,s=M(n);a<s;a++){var u=n[a],c=e?e(u,a,n):u;t?(a&&i===c||o.push(u),i=c):e?w.contains(i,c)||(i.push(c),o.push(u)):w.contains(o,u)||o.push(u)}return o},w.union=function(){return w.uniq(x(arguments,!0,!0))},w.intersection=function(n){for(var t=[],e=arguments.length,r=0,o=M(n);r<o;r++){var i=n[r];if(!w.contains(t,i)){for(var a=1;a<e&&w.contains(arguments[a],i);a++);a===e&&t.push(i)}}return t},w.difference=function(n){var t=x(arguments,!0,!0,1);return w.filter(n,function(n){return!w.contains(t,n)})},w.zip=function(){return w.unzip(arguments)},w.unzip=function(n){for(var t=n&&w.max(n,M).length||0,e=Array(t),r=0;r<t;r++)e[r]=w.pluck(n,r);return e},w.object=function(n,t){for(var e={},r=0,o=M(n);r<o;r++)t?e[n[r]]=t[r]:e[n[r][0]]=n[r][1];return e},w.findIndex=t(1),w.findLastIndex=t(-1),w.sortedIndex=function(n,t,e,r){e=_(e,r,1);for(var o=e(t),i=0,a=M(n);i<a;){var s=Math.floor((i+a)/2);e(n[s])<o?i=s+1:a=s}return i},w.indexOf=r(1,w.findIndex,w.sortedIndex),w.lastIndexOf=r(-1,w.findLastIndex),w.range=function(n,t,e){null==t&&(t=n||0,n=0),e=e||1;for(var r=Math.max(Math.ceil((t-n)/e),0),o=Array(r),i=0;i<r;i++,n+=e)o[i]=n;return o};var j=function(n,t,e,r,o){if(!(r instanceof t))return n.apply(e,o);var i=O(n.prototype),a=n.apply(i,o);return w.isObject(a)?a:i};w.bind=function(n,t){if(v&&n.bind===v)return v.apply(n,f.call(arguments,1));if(!w.isFunction(n))throw new TypeError("Bind must be called on a function");var e=f.call(arguments,2),r=function(){return j(n,r,t,this,e.concat(f.call(arguments)))};return r},w.partial=function(n){var t=f.call(arguments,1),e=function(){for(var r=0,o=t.length,i=Array(o),a=0;a<o;a++)i[a]=t[a]===w?arguments[r++]:t[a];for(;r<arguments.length;)i.push(arguments[r++]);return j(n,e,this,this,i)};return e},w.bindAll=function(n){var t,e,r=arguments.length;if(r<=1)throw new Error("bindAll must be passed function names");for(t=1;t<r;t++)e=arguments[t],n[e]=w.bind(n[e],n);return n},w.memoize=function(n,t){var e=function(r){var o=e.cache,i=""+(t?t.apply(this,arguments):r);return w.has(o,i)||(o[i]=n.apply(this,arguments)),o[i]};return e.cache={},e},w.delay=function(n,t){var e=f.call(arguments,2);return setTimeout(function(){return n.apply(null,e)},t)},w.defer=w.partial(w.delay,w,1),w.throttle=function(n,t,e){var r,o,i,a=null,s=0;e||(e={});var u=function(){s=e.leading===!1?0:w.now(),a=null,i=n.apply(r,o),a||(r=o=null)};return function(){var c=w.now();s||e.leading!==!1||(s=c);var l=t-(c-s);return r=this,o=arguments,l<=0||l>t?(a&&(clearTimeout(a),a=null),s=c,i=n.apply(r,o),a||(r=o=null)):a||e.trailing===!1||(a=setTimeout(u,l)),i}},w.debounce=function(n,t,e){var r,o,i,a,s,u=function(){var c=w.now()-a;c<t&&c>=0?r=setTimeout(u,t-c):(r=null,e||(s=n.apply(i,o),r||(i=o=null)))};return function(){i=this,o=arguments,a=w.now();var c=e&&!r;return r||(r=setTimeout(u,t)),c&&(s=n.apply(i,o),i=o=null),s}},w.wrap=function(n,t){return w.partial(t,n)},w.negate=function(n){return function(){return!n.apply(this,arguments)}},w.compose=function(){var n=arguments,t=n.length-1;return function(){for(var e=t,r=n[t].apply(this,arguments);e--;)r=n[e].call(this,r);return r}},w.after=function(n,t){return function(){if(--n<1)return t.apply(this,arguments)}},w.before=function(n,t){var e;return function(){return--n>0&&(e=t.apply(this,arguments)),n<=1&&(t=null),e}},w.once=w.partial(w.before,2);var C=!{toString:null}.propertyIsEnumerable("toString"),A=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];w.keys=function(n){if(!w.isObject(n))return[];if(m)return m(n);var t=[];for(var e in n)w.has(n,e)&&t.push(e);return C&&o(n,t),t},w.allKeys=function(n){if(!w.isObject(n))return[];var t=[];for(var e in n)t.push(e);return C&&o(n,t),t},w.values=function(n){for(var t=w.keys(n),e=t.length,r=Array(e),o=0;o<e;o++)r[o]=n[t[o]];return r},w.mapObject=function(n,t,e){t=_(t,e);for(var r,o=w.keys(n),i=o.length,a={},s=0;s<i;s++)r=o[s],a[r]=t(n[r],r,n);return a},w.pairs=function(n){for(var t=w.keys(n),e=t.length,r=Array(e),o=0;o<e;o++)r[o]=[t[o],n[t[o]]];return r},w.invert=function(n){for(var t={},e=w.keys(n),r=0,o=e.length;r<o;r++)t[n[e[r]]]=e[r];return t},w.functions=w.methods=function(n){var t=[];for(var e in n)w.isFunction(n[e])&&t.push(e);return t.sort()},w.extend=T(w.allKeys),w.extendOwn=w.assign=T(w.keys),w.findKey=function(n,t,e){t=_(t,e);for(var r,o=w.keys(n),i=0,a=o.length;i<a;i++)if(r=o[i],t(n[r],r,n))return r},w.pick=function(n,t,e){var r,o,i={},a=n;if(null==a)return i;w.isFunction(t)?(o=w.allKeys(a),r=b(t,e)):(o=x(arguments,!1,!1,1),r=function(n,t,e){return t in e},a=Object(a));for(var s=0,u=o.length;s<u;s++){var c=o[s],l=a[c];r(l,c,a)&&(i[c]=l)}return i},w.omit=function(n,t,e){if(w.isFunction(t))t=w.negate(t);else{var r=w.map(x(arguments,!1,!1,1),String);t=function(n,t){return!w.contains(r,t)}}return w.pick(n,t,e)},w.defaults=T(w.allKeys,!0),w.create=function(n,t){var e=O(n);return t&&w.extendOwn(e,t),e},w.clone=function(n){return w.isObject(n)?w.isArray(n)?n.slice():w.extend({},n):n},w.tap=function(n,t){return t(n),n},w.isMatch=function(n,t){var e=w.keys(t),r=e.length;if(null==n)return!r;for(var o=Object(n),i=0;i<r;i++){var a=e[i];if(t[a]!==o[a]||!(a in o))return!1}return!0};var L=function(n,t,e,r){if(n===t)return 0!==n||1/n===1/t;if(null==n||null==t)return n===t;n instanceof w&&(n=n._wrapped),t instanceof w&&(t=t._wrapped);var o=p.call(n);if(o!==p.call(t))return!1;switch(o){case"[object RegExp]":case"[object String]":return""+n==""+t;case"[object Number]":return+n!==+n?+t!==+t:0===+n?1/+n===1/t:+n===+t;case"[object Date]":case"[object Boolean]":return+n===+t}var i="[object Array]"===o;if(!i){if("object"!=typeof n||"object"!=typeof t)return!1;var a=n.constructor,s=t.constructor;if(a!==s&&!(w.isFunction(a)&&a instanceof a&&w.isFunction(s)&&s instanceof s)&&"constructor"in n&&"constructor"in t)return!1}e=e||[],r=r||[];for(var u=e.length;u--;)if(e[u]===n)return r[u]===t;if(e.push(n),r.push(t),i){if(u=n.length,u!==t.length)return!1;for(;u--;)if(!L(n[u],t[u],e,r))return!1}else{var c,l=w.keys(n);if(u=l.length,w.keys(t).length!==u)return!1;for(;u--;)if(c=l[u],!w.has(t,c)||!L(n[c],t[c],e,r))return!1}return e.pop(),r.pop(),!0};w.isEqual=function(n,t){return L(n,t)},w.isEmpty=function(n){return null==n||(E(n)&&(w.isArray(n)||w.isString(n)||w.isArguments(n))?0===n.length:0===w.keys(n).length)},w.isElement=function(n){return!(!n||1!==n.nodeType)},w.isArray=h||function(n){return"[object Array]"===p.call(n)},w.isObject=function(n){var t=typeof n;return"function"===t||"object"===t&&!!n},w.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(n){w["is"+n]=function(t){return p.call(t)==="[object "+n+"]"}}),w.isArguments(arguments)||(w.isArguments=function(n){return w.has(n,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(w.isFunction=function(n){return"function"==typeof n||!1}),w.isFinite=function(n){return isFinite(n)&&!isNaN(parseFloat(n))},w.isNaN=function(n){return w.isNumber(n)&&n!==+n},w.isBoolean=function(n){return n===!0||n===!1||"[object Boolean]"===p.call(n)},w.isNull=function(n){return null===n},w.isUndefined=function(n){return void 0===n},w.has=function(n,t){return null!=n&&d.call(n,t)},w.noConflict=function(){return i._=a,this},w.identity=function(n){return n},w.constant=function(n){return function(){return n}},w.noop=function(){},w.property=I,w.propertyOf=function(n){return null==n?function(){}:function(t){return n[t]}},w.matcher=w.matches=function(n){return n=w.extendOwn({},n),function(t){return w.isMatch(t,n)}},w.times=function(n,t,e){var r=Array(Math.max(0,n));t=b(t,e,1);for(var o=0;o<n;o++)r[o]=t(o);return r},w.random=function(n,t){return null==t&&(t=n,n=0),n+Math.floor(Math.random()*(t-n+1))},w.now=Date.now||function(){return(new Date).getTime()};var q={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},N=w.invert(q),F=function(n){var t=function(t){return n[t]},e="(?:"+w.keys(n).join("|")+")",r=RegExp(e),o=RegExp(e,"g");return function(n){return n=null==n?"":""+n,r.test(n)?n.replace(o,t):n}};w.escape=F(q),w.unescape=F(N),w.result=function(n,t,e){var r=null==n?void 0:n[t];return void 0===r&&(r=e),w.isFunction(r)?r.call(n):r};var R=0;w.uniqueId=function(n){var t=++R+"";return n?n+t:t},w.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var D=/(.)^/,W={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},B=/\\|'|\r|\n|\u2028|\u2029/g,H=function(n){return"\\"+W[n]};w.template=function(n,t,e){!t&&e&&(t=e),t=w.defaults({},t,w.templateSettings);var r=RegExp([(t.escape||D).source,(t.interpolate||D).source,(t.evaluate||D).source].join("|")+"|$","g"),o=0,i="__p+='";n.replace(r,function(t,e,r,a,s){return i+=n.slice(o,s).replace(B,H),o=s+t.length,e?i+="'+\n((__t=("+e+"))==null?'':_.escape(__t))+\n'":r?i+="'+\n((__t=("+r+"))==null?'':__t)+\n'":a&&(i+="';\n"+a+"\n__p+='"),t}),i+="';\n",t.variable||(i="with(obj||{}){\n"+i+"}\n"),i="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+i+"return __p;\n";try{var a=new Function(t.variable||"obj","_",i)}catch(n){throw n.source=i,n}var s=function(n){return a.call(this,n,w)},u=t.variable||"obj";return s.source="function("+u+"){\n"+i+"}",s},w.chain=function(n){var t=w(n);return t._chain=!0,t};var P=function(n,t){return n._chain?w(t).chain():t};w.mixin=function(n){w.each(w.functions(n),function(t){var e=w[t]=n[t];w.prototype[t]=function(){var n=[this._wrapped];return l.apply(n,arguments),P(this,e.apply(w,n))}})},w.mixin(w),w.each(["pop","push","reverse","shift","sort","splice","unshift"],function(n){var t=s[n];w.prototype[n]=function(){var e=this._wrapped;return t.apply(e,arguments),"shift"!==n&&"splice"!==n||0!==e.length||delete e[0],P(this,e)}}),w.each(["concat","join","slice"],function(n){var t=s[n];w.prototype[n]=function(){return P(this,t.apply(this._wrapped,arguments))}}),w.prototype.value=function(){return this._wrapped},w.prototype.valueOf=w.prototype.toJSON=w.prototype.value,w.prototype.toString=function(){return""+this._wrapped},"function"==typeof e&&e.amd&&e("underscore",[],function(){return w})}.call(this),e("utils/logger",[],function(){function n(n){this._enabled=n,this._enabledDebug=n,this._enabledInfo=n,this._enabledWarn=n,this._enabledError=n,this._cacheNativeConsoleMethods(),this._enabled||this.disableConsole()}n.CONSOLE_METHODS=["log","debug","info","warn","assert","dir","dirxml","group","groupEnd","time","timeEnd","count","trace","profile","profileEnd"];var t=[].slice;return n.prototype.disableDebug=function(n){null!==n&&void 0!==n||(n=!0),this._enabledDebug=!n},n.prototype.disableInfo=function(n){null!==n&&void 0!==n||(n=!0),this._enabledInfo=!n},n.prototype.disableWarn=function(n){null!==n&&void 0!==n||(n=!0),this._enabledWarn=!n},n.prototype.disableError=function(n){null!==n&&void 0!==n||(n=!0),this._enabledError=!n},n.prototype.debug=function(){var n,e;n=arguments[0],e=2<=arguments.length?t.call(arguments,1):[],this._enabled&&this._enabledDebug&&(n=this._formatMessage("DEBUG",n),console.log.apply(console,[n].concat(t.call(e))))},n.prototype.info=function(){var n,e;n=arguments[0],e=2<=arguments.length?t.call(arguments,1):[],this._enabled&&this._enabledInfo&&(n=this._formatMessage("INFO",n),console.log.apply(console,[n].concat(t.call(e))))},n.prototype.warn=function(){var n,e;n=arguments[0],e=2<=arguments.length?t.call(arguments,1):[],this._enabled&&this._enabledWarn&&(n=this._formatMessage("WARN",n),console.warn.apply(console,[n].concat(t.call(e))))},n.prototype.error=function(){var n,e;n=arguments[0],e=2<=arguments.length?t.call(arguments,1):[],this._enabled&&this._enabledError&&(n=this._formatMessage("ERROR",n),console.error.apply(console,[n].concat(t.call(e))))},n.prototype._formatMessage=function(n,t){var e;return e=this.formatTime(),"["+n+"] "+e+": "+t},n.prototype._cacheNativeConsoleMethods=function(){var t,e,r,o;for(this._nativeConsoleMethods={},o=n.CONSOLE_METHODS,t=0,e=o.length;t<e;t++)r=o[t],this._nativeConsoleMethods[r]=console[r]},n.prototype.enableConsole=function(){var t,e,r,o;if(this._nativeConsoleMethods)for(o=n.CONSOLE_METHODS,t=0,e=o.length;t<e;t++)r=o[t],console[r]=this._nativeConsoleMethods[r]},n.prototype.disableConsole=function(){var t,e,r,o;for(o=n.CONSOLE_METHODS,t=0,e=o.length;t<e;t++)r=o[t],console[r]=function(){}},n.prototype.formatTime=function(n){n||(n=new Date);var t=this.pad(n.getHours(),2),e=this.pad(n.getMinutes(),2),r=this.pad(n.getSeconds(),2),o=this.pad(n.getMilliseconds(),2);return t+":"+e+":"+r+":"+o},n.prototype.pad=function(n,t,e){for(e||(e="0"),n=String(n);n.length<t;)n=e+n;return n},n}),e("utils/time_tracker",[],function(){function n(){this.metrics={}}return n.prototype.start=function(n){this.metrics[n]={},this.metrics[n].startTime=performance.now()},n.prototype.end=function(n){if(!this.metrics[n])return null;var t=performance.now()-this.metrics[n].startTime;return delete this.metrics[n],t},n}),e("utils/polyfills",[],{defineFind:function(){Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(n){if(null===this)throw new TypeError('"this" is null or not defined');var t=Object(this),e=t.length>>>0;if("function"!=typeof n)throw new TypeError("predicate must be a function");for(var r=arguments[1],o=0;o<e;){var i=t[o];if(n.call(r,i,o,t))return i;o++}}})}}),e("client/moment_loader",["utils/string_utils","underscore","utils/logger","utils/time_tracker","utils/polyfills"],function(n,t,e,r,o){function i(n){try{this.logger=new e(!0),this.performance=[],this.timeTracker=new r,this.timeTracker.start("iframeLoad"),this.setRequestParams(n),this.conversationId=0,this.conversationsMap={},this.queuedConversations=[],window.addEventListener("message",this.receiveMoments.bind(this),!1),this.iframe=document.getElementById("momentLoaderFrame"),this.iframe||(this.iframe=document.createElement("iframe"),this.iframe.style.display="none",this.iframe.src=this.serverSrc,this.iframe.id="momentLoaderFrame",document.body.appendChild(this.iframe))}catch(n){throw n}}function a(n){this.momentLoaderClient=null,this.getInstance=function(){return this.momentLoaderClient||(this.momentLoaderClient=new i(n)),this.momentLoaderClient}}return i.prototype.setRequestParams=function(n){if(!n||!n.env)throw new Error("must pass in valid env");this.env=n.env,this.trackingCallback=n.trackingCallback,this.setAllowedOrigins(window.location.hostname),this.setSrc(window.location.hostname),this.setTargetOrigin(window.location.hostname)},i.prototype.serverSrcTemplate="//photos.{0}shutterfly.com/pmc_momentdb_server.html?subdomain={1}&domain={2}",i.prototype.targetOriginTemplate="//photos.{0}shutterfly.com",i.prototype.allowedOriginsTemplates=["//{0}shutterfly.com","//photos.{0}shutterfly.com","//pmc.local.thislife.com","//www.{0}tinyprints.com"],i.prototype.setTargetOrigin=function(t){"photos.local.shutterfly.com"==t?this.targetOrigin=n.replace(this.targetOriginTemplate,["local."]):"pmc.local.thislife.com"==t?this.targetOrigin="//pmc.local.thislife.com":"prod"==this.env?this.targetOrigin=n.replace(this.targetOriginTemplate,[""]):this.targetOrigin=n.replace(this.targetOriginTemplate,[this.env+"."]),this.targetOrigin=n.getProtocol()+this.targetOrigin},i.prototype.setSrc=function(t){var e=t.match(/^(.+).(shutterfly|tinyprints).com$/),r=e?e[1]:"",o=e?e[2]:"";"pmc.local.thislife.com"==t?this.serverSrc="//pmc.local.thislife.com/pmc_momentdb_server.html?subdomain=//pmc.local.thislife.com":"photos.local.shutterfly.com"==t?this.serverSrc=n.replace(this.serverSrcTemplate,["local.",r,o]):"prod"==this.env?this.serverSrc=n.replace(this.serverSrcTemplate,["",r,o]):this.serverSrc=n.replace(this.serverSrcTemplate,[this.env+".",r,o])},i.prototype.setAllowedOrigins=function(t){this.allowedOrigins=[];for(var e=n.getProtocol(),r=0;r<this.allowedOriginsTemplates.length;r++)"pmc.local.thislife.com"==t||"photos.local.shutterfly.com"==t?this.allowedOrigins.push(e+n.replace(this.allowedOriginsTemplates[r],["local."])):"prod"===this.env?this.allowedOrigins.push(e+n.replace(this.allowedOriginsTemplates[r],[""])):this.allowedOrigins.push(e+n.replace(this.allowedOriginsTemplates[r],[this.env+"."]))},i.prototype.generateConversationId=function(){return this.conversationId++,this.conversationId+""},i.prototype.parseStoryMoments=function(n,t,e){if(t&&e){conversationId=this.generateConversationId();var r="parseStoryMoments";this.timeTracker.start(r),this.conversationsMap[conversationId]={onSuccess:t,onError:e,command:r},this.readyToLoad?this.iframe.contentWindow.postMessage({momentsStr:n.momentsStr,filenames:n.filenames,conversationId:conversationId,command:r},this.targetOrigin):this.queuedConversations.push({conversationId:conversationId,command:r,data:{momentsStr:n.momentsStr,filenames:n.filenames}})}else this.logger.error("Must pass valid callback functions to parseStoryMoments method")},i.prototype.parseMomentsHex=function(n,t,e){if(t&&e&&n.hex){conversationId=this.generateConversationId();var r="parseMomentsHex";this.timeTracker.start(r),this.conversationsMap[conversationId]={onSuccess:t,onError:e,command:r},this.readyToLoad?this.iframe.contentWindow.postMessage({conversationId:conversationId,hex:n.hex,command:r},this.targetOrigin):this.queuedConversations.push({conversationId:conversationId,command:r,data:{hex:n.hex}})}else this.logger.error("Must pass valid data and callback functions to parseMomentsHex method")},i.prototype.loadMoments=function(n,t,e){if(t&&e&&n.lifeUid){conversationId=this.generateConversationId();var r="load";this.timeTracker.start(r),this.conversationsMap[conversationId]={onSuccess:t,onError:e,command:r},window.$sflyAuth?window.$sflyAuth.getIdToken().then(function(t){this.readyToLoad?this.iframe.contentWindow.postMessage({oauthToken:t.jwtToken,env:this.env,lifeUid:n.lifeUid,conversationId:conversationId,command:r},this.targetOrigin):this.queuedConversations.push({conversationId:conversationId,command:r,data:{oauthToken:t.jwtToken,env:this.env,lifeUid:n.lifeUid}})}.bind(this)):this.readyToLoad&&n.oauthToken?this.iframe.contentWindow.postMessage({oauthToken:n.oauthToken,env:this.env,lifeUid:n.lifeUid,conversationId:conversationId,command:r},this.targetOrigin):this.queuedConversations.push({conversationId:conversationId,command:r,data:{oauthToken:n.oauthToken,env:this.env,lifeUid:n.lifeUid}})}else this.logger.error("Must pass valid data and callback functions to loadMoments method")},i.prototype.clearMoments=function(n,t){if(n&&t){conversationId=this.generateConversationId();var e="clear";this.timeTracker.start(e),this.conversationsMap[conversationId]={onSuccess:n,onError:t,command:e},this.readyToLoad?this.iframe.contentWindow.postMessage({conversationId:conversationId,command:e},this.targetOrigin):this.queuedConversations.push({conversationId:conversationId,command:e})}else this.logger.error("Must pass valid callback function to clearMoments method")},i.prototype.filterMoments=function(n,t,e){if(t&&e&&n.attribute&&null!==n.isRange&&n.values){conversationId=this.generateConversationId();var r="filter";this.timeTracker.start(r),this.conversationsMap[conversationId]={onSuccess:t,onError:e,command:r},this.readyToLoad?this.iframe.contentWindow.postMessage({conversationId:conversationId,command:r,attribute:n.attribute,isRange:n.isRange,values:n.values},this.targetOrigin):this.queuedConversations.push({conversationId:conversationId,command:r,data:{attribute:n.attribute,isRange:n.isRange,values:n.values}})}else this.logger.error("Must pass valid options and callback function to filterMoments method")},i.prototype.refreshMoments=function(n,t){if(n&&t){conversationId=this.generateConversationId();var e="refresh";this.timeTracker.start(e),this.conversationsMap[conversationId]={onSuccess:n,onError:t,command:e},this.readyToLoad?this.iframe.contentWindow.postMessage({conversationId:conversationId,command:e},this.targetOrigin):this.queuedConversations.push({conversationId:conversationId,command:e})}else this.logger.error("Must pass valid callback function to refeshMoments method")},i.prototype.receiveMoments=function(n){var e,r="",i="";if(Array.prototype.find||o.defineFind(),void 0===this.allowedOrigins.find(function(t){return t===n.origin})&&this.logger.warn("Origin not allowed: "+n.origin),"ready"==n.data)for(this.readyToLoad=!0,this.performance.push({name:"iframeLoad",value:this.timeTracker.end("iframeLoad")});this.queuedConversations.length;)e=this.queuedConversations.pop(),r=e.conversationId,i=e.command,data=e.data?t.extend(e.data,{conversationId:r,command:i}):{conversationId:r,command:i},this.iframe.contentWindow.postMessage(data,this.targetOrigin);else if(r=n.data.conversationId,conversationHandlers=this.conversationsMap[r],r&&conversationHandlers)if(i=conversationHandlers.command,this.performance.push({name:i,value:this.timeTracker.end(i)
}),n.data&&n.data.result){var a=conversationHandlers.onSuccess;this.trackingCallback&&(n.data.result.performance&&(this.performance=this.performance.concat(n.data.result.performance)),this.trackingCallback(this.performance),this.performance=[]),a(n.data.result)}else{var s=n.data&&n.data.error?n.data.error:"Invalid moment data returned from moment loader server",u=conversationHandlers.onError;u(s)}else this.logger.warn("no valid conversation id in this event: "+JSON.stringify(n))},a}),t(["client/moment_loader"],function(n){"function"==typeof window.define&&window.define.amd?window.define("MomentDbClient",[],function(){return n}):window.MomentDbClient=n}),_.noConflict(),e("client/export",function(){})}();